<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js" integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "$", right: "$", display: false}
            ]
        });
    });
</script>

<!--
<div class="td-toc"><nav id="TableOfContents"><div>
            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#logger">logger</a>
            </li>
            <li>
                    <a class="variable" href="#LightSpeed">LightSpeed</a>
            </li>
            <li>
                    <a class="class" href="#Detector">Detector</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Detector.r">r</a>
                        </li>
                        <li>
                                <a class="variable" href="#Detector.q">q</a>
                        </li>
                        <li>
                                <a class="variable" href="#Detector.basepoint">basepoint</a>
                        </li>
                        <li>
                                <a class="variable" href="#Detector.refpoint">refpoint</a>
                        </li>
                        <li>
                                <a class="function" href="#Detector.centre">centre</a>
                        </li>
                        <li>
                                <a class="variable" href="#Detector.normal">normal</a>
                        </li>
                        <li>
                                <a class="function" href="#Detector.get_distance">get_distance</a>
                        </li>
                        <li>
                                <a class="function" href="#Detector.shiftToDistance">shiftToDistance</a>
                        </li>
                        <li>
                                <a class="function" href="#Detector.shiftByDistance">shiftByDistance</a>
                        </li>
                        <li>
                                <a class="function" href="#Detector.get_2D_points">get_2D_points</a>
                        </li>
                        <li>
                                <a class="function" href="#Detector.get_3D_points">get_3D_points</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#InfiniteDetector">InfiniteDetector</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#InfiniteDetector.__init__">InfiniteDetector</a>
                        </li>
                        <li>
                                <a class="variable" href="#InfiniteDetector.centre">centre</a>
                        </li>
                        <li>
                                <a class="variable" href="#InfiniteDetector.orientation">orientation</a>
                        </li>
                        <li>
                                <a class="variable" href="#InfiniteDetector.normal">normal</a>
                        </li>
                        <li>
                                <a class="variable" href="#InfiniteDetector.refpoint">refpoint</a>
                        </li>
                        <li>
                                <a class="function" href="#InfiniteDetector.copy_detector">copy_detector</a>
                        </li>
                        <li>
                                <a class="function" href="#InfiniteDetector.autoplace">autoplace</a>
                        </li>
                        <li>
                                <a class="function" href="#InfiniteDetector.get_distance">get_distance</a>
                        </li>
                        <li>
                                <a class="function" href="#InfiniteDetector.shiftToDistance">shiftToDistance</a>
                        </li>
                        <li>
                                <a class="function" href="#InfiniteDetector.shiftByDistance">shiftByDistance</a>
                        </li>
                        <li>
                                <a class="function" href="#InfiniteDetector.get_PointList3D">get_PointList3D</a>
                        </li>
                        <li>
                                <a class="function" href="#InfiniteDetector.get_PointList2D">get_PointList2D</a>
                        </li>
                        <li>
                                <a class="function" href="#InfiniteDetector.get_PointList2DCentre">get_PointList2DCentre</a>
                        </li>
                        <li>
                                <a class="function" href="#InfiniteDetector.get_Delays">get_Delays</a>
                        </li>
                </ul>

            </li>
    </ul>

</div></nav></div>
-->

<!--
We comment the TOC out because we want to integrate it into the page layout of Docsy
-->


<div class="pdoc">
            <section class="module-info">
                    

                        <div class="docstring"><p>Provides a class which represents a virtual detector —a plane in 3D space— with methods
to analyze the impact points of a ray bundle intercepting it.</p>

<p><img src="detector.svg" alt="Illustration of the detector plane." /></p>

<p>Created in Sept 2020</p>

<p>@author: Stefan Haessler + André Kalouguine</p>
</div>

                        <input id="mod-ModuleDetector-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-ModuleDetector-view-source"><span>View Source</span></label>

                        <div class="chroma pdoc-code"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">Provides a class which represents a virtual detector —a plane in 3D space— with methods</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">to analyze the impact points of a ray bundle intercepting it.</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">![Illustration of the detector plane.](detector.svg)</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">Created in Sept 2020</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">@author: Stefan Haessler + André Kalouguine</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="c1"># %% Modules</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">import</span> <span class="nn">quaternion</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">import</span> <span class="nn">ARTcore.ModuleProcessing</span> <span class="k">as</span> <span class="nn">mp</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">import</span> <span class="nn">ARTcore.ModuleOpticalRay</span> <span class="k">as</span> <span class="nn">mray</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">import</span> <span class="nn">ARTcore.ModuleGeometry</span> <span class="k">as</span> <span class="nn">mgeo</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="c1"># This is to allow multiple constructors based on the type of the first argument</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">singledispatchmethod</span> 
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="n">LightSpeed</span> <span class="o">=</span> <span class="mi">299792458000</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="c1"># %%</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="k">class</span> <span class="nc">Detector</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    Abstract class describing a detector and the properties/methods it has to have. </span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>    <span class="c1">## Starting 3d orientation definition</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>    <span class="nd">@property</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>    <span class="k">def</span> <span class="nf">r</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>    <span class="nd">@r</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="k">def</span> <span class="nf">r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NewPosition</span><span class="p">):</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewPosition</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">NewPosition</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_r</span> <span class="o">=</span> <span class="n">NewPosition</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Position must be a 3D numpy.ndarray.&quot;</span><span class="p">)</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a> 
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>    <span class="nd">@property</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>    <span class="k">def</span> <span class="nf">q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>    
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>    <span class="nd">@q</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>    <span class="k">def</span> <span class="nf">q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NewOrientation</span><span class="p">):</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">NewOrientation</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">quaternion</span><span class="p">):</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">NewOrientation</span><span class="o">.</span><span class="n">normalised</span><span class="p">()</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Orientation must be a quaternion.&quot;</span><span class="p">)</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>    <span class="nd">@property</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>    <span class="k">def</span> <span class="nf">basepoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basepoint_ref</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>    
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>    <span class="nd">@basepoint</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>    <span class="k">def</span> <span class="nf">basepoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NewPosition</span><span class="p">):</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewPosition</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">NewPosition</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_r</span> <span class="o">=</span> <span class="n">NewPosition</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basepoint_ref</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Position must be a 3D numpy.ndarray.&quot;</span><span class="p">)</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>    
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>    <span class="c1">## End of 3d orientation definition</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>    <span class="c1">## Start of points and vectors definitions</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>    <span class="nd">@property</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>    <span class="k">def</span> <span class="nf">refpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>    
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>    <span class="nd">@refpoint</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>    <span class="k">def</span> <span class="nf">refpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NewRefPoint</span><span class="p">):</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewRefPoint</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">NewRefPoint</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">NewRefPoint</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Reference Point must be a 3D numpy.ndarray.&quot;</span><span class="p">)</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="nf">centre</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="k">pass</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>    <span class="nd">@property</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>    <span class="k">def</span> <span class="nf">normal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">quaternion</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_normal</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>    <span class="c1">## End of points and vectors definitions</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>    
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="nf">get_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        Return distance of the Detector from its reference point Detector.refpoint.</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refpoint</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="nf">shiftToDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NewDistance</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">        Shift the Detector to the distance NewDistance from its reference point Detector.refpoint.</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">        Parameters</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        ----------</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">            NewDistance : float</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">                The distance (absolute) to which to shift the Detector.</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>            <span class="n">shiftby</span> <span class="o">=</span> <span class="n">NewDistance</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distance</span><span class="p">()</span>  <span class="c1"># by that much in the self.normal-direction</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The new Detector Distance must be int or float.&quot;</span><span class="p">)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">+=</span> <span class="o">-</span><span class="n">shiftby</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>    <span class="k">def</span> <span class="nf">shiftByDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Shift</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">        Shift the Detector *by* the distance Shift along its normal vector Detector.normal.</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">        Parameters</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">        ----------</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">            Shift : float</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">                The distance (relative) *by* which to shift the Detector.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">-</span> <span class="n">Shift</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span>  <span class="c1"># directly set _centre, i.e. circumvent setter</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The Detector Distance Shift must be int or float.&quot;</span><span class="p">)</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>    <span class="k">def</span> <span class="nf">get_2D_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">):</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        <span class="k">pass</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>    <span class="k">def</span> <span class="nf">get_3D_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">):</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="k">pass</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>    <span class="k">def</span> <span class="nf">_copy_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>        <span class="k">pass</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="k">class</span> <span class="nc">InfiniteDetector</span><span class="p">(</span><span class="n">Detector</span><span class="p">):</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">    A detector is simply a plane in 3D-lab-space.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">    It is defined by a point Detector.centre and its</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">    orientation Detector.orientation (a quaternion rotating it from the initial alignment)</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">    These are optional arguments when creating a Detector-instance, because they can</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">    later be set automatically by the method Detector.autoplace().</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">    The Detector has a reference point &quot;RefPoint&quot;, with respect to which a distance</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">    can be returned via the method Detector.get distance.</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">    Attributes</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">    ----------</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">        centre : np.ndarray</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">            3D Point in the Detector plane.</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">        normal : np.ndarray</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">           3D Normal vector on the Detector plane.</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">        refpoint : np.ndarray</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">            3D reference point from which to measure the Detector distance.</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>    <span class="nd">@singledispatchmethod</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Orientation</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">quaternion</span><span class="p">,</span> <span class="n">Centre</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">RefPoint</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        Parameters</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        ----------</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">            Orientation : np.quaternion</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">               Quaternion describing rotation from initial orientation (x-axis along x axis, normal towards positive z).</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">            Centre : np.ndarray</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">               3D Point in the Detector plane.</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">            RefPoint : np.ndarray, optional</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">                3D Reference point from which to measure the Detector distance.</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="n">Centre</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">Centre</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">Orientation</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">RefPoint</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">RefPoint</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">RefPoint</span><span class="p">)</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>    <span class="nd">@__init__</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>    <span class="k">def</span> <span class="nf">_from_normal_and_centre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Normal</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Centre</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">RefPoint</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">IncidencePlane</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using normal vector to orient detector&quot;</span><span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="n">Centre</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="n">Normal</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">Normal</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">RefPoint</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">RefPoint</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">RefPoint</span><span class="p">)</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="n">IncidencePlane</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Registering a detector based only on the normal vector is not recommended.&quot;</span><span class="p">)</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">QRotationVector2Vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">Normal</span><span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">IncidencePlane</span><span class="p">,</span> <span class="n">Normal</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">:</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Attempting to define a detector based on a normal and an incidence plane, however normal is not within incidence plane. Therefore, not using the incidence plane.&quot;</span><span class="p">)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">QRotationVector2Vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">Normal</span><span class="p">)</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">QRotationVectorPair2VectorPair</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="n">IncidencePlane</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">Normal</span><span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>    
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>    <span class="nd">@__init__</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">mray</span><span class="o">.</span><span class="n">Ray</span><span class="p">)</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>    <span class="k">def</span> <span class="nf">_from_ray_and_centre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Ray</span><span class="p">:</span><span class="n">mray</span><span class="o">.</span><span class="n">Ray</span><span class="p">,</span> <span class="n">Centre</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">RefPoint</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">IncidencePlane</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using ray to orient detector&quot;</span><span class="p">)</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>        <span class="n">Centre</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="n">Normal</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">Ray</span><span class="o">.</span><span class="n">vector</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">RefPoint</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">RefPoint</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">RefPoint</span><span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">Ray</span><span class="o">.</span><span class="n">point</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>        <span class="k">if</span> <span class="n">IncidencePlane</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Registering a detector based only on the normal vector is not recommended.&quot;</span><span class="p">)</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">QRotationVector2Vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">Normal</span><span class="p">)</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">IncidencePlane</span><span class="p">,</span> <span class="n">Normal</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Attempting to define a detector based on a normal and an incidence plane, however normal is not within incidence plane. Therefore, not using the incidence plane.&quot;</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">QRotationVector2Vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">Normal</span><span class="p">)</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">QRotationVectorPair2VectorPair</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="n">IncidencePlane</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">Normal</span><span class="p">)</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>    <span class="nd">@property</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>    <span class="k">def</span> <span class="nf">centre</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>    <span class="c1"># a setter function</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>    <span class="nd">@centre</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>    <span class="k">def</span> <span class="nf">centre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Centre</span><span class="p">):</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Centre</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="ow">and</span> <span class="n">Centre</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Detector Centre must be a 3D-vector, given as numpy.ndarray of shape (3,).&quot;</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>    <span class="nd">@property</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>    <span class="k">def</span> <span class="nf">orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>    
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>    <span class="nd">@orientation</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>    <span class="k">def</span> <span class="nf">orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Orientation</span><span class="p">):</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Orientation</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">quaternion</span><span class="p">):</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">Orientation</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Detector Orientation must be a Quaternion&quot;</span><span class="p">)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>    <span class="nd">@property</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>    <span class="k">def</span> <span class="nf">normal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="n">internal_normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">quaternion</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">internal_normal</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span><span class="o">.</span><span class="n">imag</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>    <span class="nd">@property</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>    <span class="k">def</span> <span class="nf">refpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>    <span class="c1"># a setter function</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>    <span class="nd">@refpoint</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>    <span class="k">def</span> <span class="nf">refpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RefPoint</span><span class="p">):</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">RefPoint</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="ow">and</span> <span class="n">RefPoint</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">RefPoint</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Detector RefPoint must a 3D-vector, given as numpy.ndarray of shape (3,).&quot;</span><span class="p">)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>    <span class="c1"># %% METHODS FOR PLACING THE DETECTOR ##################################################################</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>    <span class="k">def</span> <span class="nf">copy_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">        Returns a new Detector object with the same properties.</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="k">return</span> <span class="n">Detector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refpoint</span><span class="p">)</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>    <span class="k">def</span> <span class="nf">autoplace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">,</span> <span class="n">DistanceDetector</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">        Automatically place and orient the detector such that it is normal to the central ray</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">        of the supplied RayList, at the distance DistanceDetector the origin point of that central ray.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">        Parameters</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">        ----------</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">            RayList : list[Ray]</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">                A list of objects of the ModuleOpticalRay.Ray-class.</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">            DistanceDetector : float</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">                The distance at which to place the Detector.</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="n">CentralRay</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">FindCentralRay</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="n">CentralRay</span> <span class="o">=</span> <span class="n">RayList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="k">if</span> <span class="n">CentralRay</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find central ray! The list of rays has a length of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>            <span class="n">CentralPoint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">RayList</span><span class="p">:</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>                <span class="n">CentralPoint</span> <span class="o">=</span> <span class="n">CentralPoint</span> <span class="o">+</span> <span class="n">k</span><span class="o">.</span><span class="n">point</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>            <span class="n">CentralPoint</span> <span class="o">=</span> <span class="n">CentralPoint</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found central ray, using it to position detector: </span><span class="se">\n</span><span class="si">{</span><span class="n">CentralRay</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>            <span class="n">CentralPoint</span> <span class="o">=</span> <span class="n">CentralRay</span><span class="o">.</span><span class="n">point</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">=</span> <span class="n">CentralPoint</span> <span class="o">+</span> <span class="n">CentralRay</span><span class="o">.</span><span class="n">vector</span> <span class="o">*</span> <span class="n">DistanceDetector</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refpoint</span> <span class="o">=</span> <span class="n">CentralPoint</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>    <span class="k">def</span> <span class="nf">get_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">        Return distance of the Detector-plane from its reference point Detector.refpoint.</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refpoint</span> <span class="o">-</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">IntersectionLinePlane</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refpoint</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">normal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span><span class="p">)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        <span class="p">)</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>    <span class="k">def</span> <span class="nf">shiftToDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NewDistance</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">        Shift the Detector to the distance NewDistance from its reference point Detector.refpoint.</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">        Parameters</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">        ----------</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">            NewDistance : float</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">                The distance (absolute) to which to shift the Detector.</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>            <span class="n">shiftby</span> <span class="o">=</span> <span class="n">NewDistance</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distance</span><span class="p">()</span>  <span class="c1"># by that much in the self.normal-direction</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The new Detector Distance must be int or float.&quot;</span><span class="p">)</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">+=</span> <span class="o">-</span><span class="n">shiftby</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>    <span class="k">def</span> <span class="nf">shiftByDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Shift</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">        Shift the Detector *by* the distance Shift along its normal vector Detector.normal.</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">        Parameters</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">        ----------</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">            Shift : float</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">                The distance (relative) *by* which to shift the Detector.</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">-</span> <span class="n">Shift</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span>  <span class="c1"># directly set _centre, i.e. circumvent setter</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The Detector Distance Shift must be int or float.&quot;</span><span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>    <span class="k">def</span> <span class="nf">_iscomplete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">        Checks whether the Detector plane is defined by a centre-point and normal-vector.</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The detector has no centre or orientation defined yet.&quot;</span><span class="p">)</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>    <span class="c1"># %% METHODS TO GET THE DETECTOR REPONSE ##################################################################</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>    <span class="k">def</span> <span class="nf">get_PointList3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">        Returns the list of 3D-points in lab-space where the rays in the</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">        list RayList hit the detector plane.</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a><span class="sd">        Parameters</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">        ----------</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">            RayList : list[Ray]</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="sd">                A list of objects of the ModuleOpticalRay.Ray-class.</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">        Returns</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="sd">        ----------</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">            ListPointDetector3D : list[np.ndarray of shape (3,)]</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="n">XY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_PointList2D</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">XY</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],))</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="n">XYZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">XY</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span><span class="n">Z</span><span class="p">]))</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="n">XYZ</span> <span class="o">=</span> <span class="n">quaternion</span><span class="o">.</span><span class="n">rotate_vectors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="n">XYZ</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="k">return</span> <span class="n">XYZ</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>    <span class="k">def</span> <span class="nf">get_PointList2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">        Returns the list of 2D-points in the detector plane, with the origin at Detector.centre.</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">        Parameters</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        ----------</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">            RayList : list[Ray]</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">                A list of objects of the ModuleOpticalRay.Ray-class of length N</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">        Returns</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">        ----------</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">            XY : np.ndarray of shape (N,2)</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        <span class="n">RayList</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">TranslationRayList</span><span class="p">(</span><span class="n">RayList</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="n">RayList</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">RotationRayListByQ</span><span class="p">(</span><span class="n">RayList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>        <span class="n">X</span><span class="p">,</span><span class="n">Y</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">IntersectionRayListZPlane</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="n">XY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">]))</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>        <span class="k">return</span> <span class="n">XY</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>    <span class="k">def</span> <span class="nf">get_PointList2DCentre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">        Returns the list of 2D-points in the detector plane, with the origin centered in the point cloud.</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">        Parameters</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">        ----------</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">            RayList* : list[Ray]</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">                A list of objects of the ModuleOpticalRay.Ray-class.</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">        Returns</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">        ----------</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">            ListPointDetector2DCentre : list[np.ndarray of shape (2,)]</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        <span class="n">ArrayPointDetector2D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_PointList2D</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="n">ArrayPointDetector2D</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ArrayPointDetector2D</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        <span class="k">return</span> <span class="n">ArrayPointDetector2D</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>    <span class="k">def</span> <span class="nf">get_Delays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">        Returns the list of delays of the rays of RayList as they hit the detector plane,</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">        calculated as their total path length divided by the speed of light.</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">        The delays are relative to the mean “travel time”, i.e. the mean path length of RayList</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">        divided by the speed of light.</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">        The list index corresponds to that of the RayList.</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">        Parameters</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="sd">        ----------</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="sd">            RayList : list[Ray]</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="sd">                A list of objects of the ModuleOpticalRay.Ray-class.</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="sd">        Returns</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="sd">        ----------</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">            DelayList : list[float]</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iscomplete</span><span class="p">():</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>            <span class="n">DetectorPointList3D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_PointList3D</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>            <span class="n">OpticalPathList</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">RayList</span><span class="p">)):</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>                <span class="n">OpticalPathList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">RayList</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">point</span> <span class="o">-</span> <span class="n">DetectorPointList3D</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RayList</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>            <span class="n">MeanPath</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">OpticalPathList</span><span class="p">)</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>            <span class="n">DelayList</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span> <span class="o">-</span> <span class="n">MeanPath</span><span class="p">)</span> <span class="o">/</span> <span class="n">LightSpeed</span> <span class="o">*</span> <span class="mf">1e15</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">OpticalPathList</span><span class="p">]</span>  <span class="c1"># in fs, c in mm/s</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>            <span class="k">return</span> <span class="n">DelayList</span>
</span></pre></div>


            </section>
                <section id="logger">
                    <div class="attr variable">
            <span class="name">logger</span>        =
<span class="default_value">&lt;Logger <a href="">ARTcore.ModuleDetector</a> (WARNING)&gt;</span>

        
    </div>
    <a class="headerlink" href="#logger"></a>
    
    

                </section>
                <section id="LightSpeed">
                    <div class="attr variable">
            <span class="name">LightSpeed</span>        =
<span class="default_value">299792458000</span>

        
    </div>
    <a class="headerlink" href="#LightSpeed"></a>
    
    

                </section>
                <section id="Detector">
                            <input id="Detector-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Detector</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="Detector-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Detector"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="Detector-35"><a href="#Detector-35"><span class="linenos"> 35</span></a><span class="k">class</span> <span class="nc">Detector</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="Detector-36"><a href="#Detector-36"><span class="linenos"> 36</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Detector-37"><a href="#Detector-37"><span class="linenos"> 37</span></a><span class="sd">    Abstract class describing a detector and the properties/methods it has to have. </span>
</span><span id="Detector-38"><a href="#Detector-38"><span class="linenos"> 38</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Detector-39"><a href="#Detector-39"><span class="linenos"> 39</span></a>    <span class="c1">## Starting 3d orientation definition</span>
</span><span id="Detector-40"><a href="#Detector-40"><span class="linenos"> 40</span></a>    <span class="nd">@property</span>
</span><span id="Detector-41"><a href="#Detector-41"><span class="linenos"> 41</span></a>    <span class="k">def</span> <span class="nf">r</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Detector-42"><a href="#Detector-42"><span class="linenos"> 42</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r</span>
</span><span id="Detector-43"><a href="#Detector-43"><span class="linenos"> 43</span></a>
</span><span id="Detector-44"><a href="#Detector-44"><span class="linenos"> 44</span></a>    <span class="nd">@r</span><span class="o">.</span><span class="n">setter</span>
</span><span id="Detector-45"><a href="#Detector-45"><span class="linenos"> 45</span></a>    <span class="k">def</span> <span class="nf">r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NewPosition</span><span class="p">):</span>
</span><span id="Detector-46"><a href="#Detector-46"><span class="linenos"> 46</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewPosition</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">NewPosition</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="Detector-47"><a href="#Detector-47"><span class="linenos"> 47</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_r</span> <span class="o">=</span> <span class="n">NewPosition</span>
</span><span id="Detector-48"><a href="#Detector-48"><span class="linenos"> 48</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Detector-49"><a href="#Detector-49"><span class="linenos"> 49</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Position must be a 3D numpy.ndarray.&quot;</span><span class="p">)</span>
</span><span id="Detector-50"><a href="#Detector-50"><span class="linenos"> 50</span></a> 
</span><span id="Detector-51"><a href="#Detector-51"><span class="linenos"> 51</span></a>    <span class="nd">@property</span>
</span><span id="Detector-52"><a href="#Detector-52"><span class="linenos"> 52</span></a>    <span class="k">def</span> <span class="nf">q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Detector-53"><a href="#Detector-53"><span class="linenos"> 53</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q</span>
</span><span id="Detector-54"><a href="#Detector-54"><span class="linenos"> 54</span></a>    
</span><span id="Detector-55"><a href="#Detector-55"><span class="linenos"> 55</span></a>    <span class="nd">@q</span><span class="o">.</span><span class="n">setter</span>
</span><span id="Detector-56"><a href="#Detector-56"><span class="linenos"> 56</span></a>    <span class="k">def</span> <span class="nf">q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NewOrientation</span><span class="p">):</span>
</span><span id="Detector-57"><a href="#Detector-57"><span class="linenos"> 57</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">NewOrientation</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">quaternion</span><span class="p">):</span>
</span><span id="Detector-58"><a href="#Detector-58"><span class="linenos"> 58</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">NewOrientation</span><span class="o">.</span><span class="n">normalised</span><span class="p">()</span>
</span><span id="Detector-59"><a href="#Detector-59"><span class="linenos"> 59</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Detector-60"><a href="#Detector-60"><span class="linenos"> 60</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Orientation must be a quaternion.&quot;</span><span class="p">)</span>
</span><span id="Detector-61"><a href="#Detector-61"><span class="linenos"> 61</span></a>
</span><span id="Detector-62"><a href="#Detector-62"><span class="linenos"> 62</span></a>    <span class="nd">@property</span>
</span><span id="Detector-63"><a href="#Detector-63"><span class="linenos"> 63</span></a>    <span class="k">def</span> <span class="nf">basepoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Detector-64"><a href="#Detector-64"><span class="linenos"> 64</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basepoint_ref</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span>
</span><span id="Detector-65"><a href="#Detector-65"><span class="linenos"> 65</span></a>    
</span><span id="Detector-66"><a href="#Detector-66"><span class="linenos"> 66</span></a>    <span class="nd">@basepoint</span><span class="o">.</span><span class="n">setter</span>
</span><span id="Detector-67"><a href="#Detector-67"><span class="linenos"> 67</span></a>    <span class="k">def</span> <span class="nf">basepoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NewPosition</span><span class="p">):</span>
</span><span id="Detector-68"><a href="#Detector-68"><span class="linenos"> 68</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewPosition</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">NewPosition</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="Detector-69"><a href="#Detector-69"><span class="linenos"> 69</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_r</span> <span class="o">=</span> <span class="n">NewPosition</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basepoint_ref</span>
</span><span id="Detector-70"><a href="#Detector-70"><span class="linenos"> 70</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Detector-71"><a href="#Detector-71"><span class="linenos"> 71</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Position must be a 3D numpy.ndarray.&quot;</span><span class="p">)</span>
</span><span id="Detector-72"><a href="#Detector-72"><span class="linenos"> 72</span></a>    
</span><span id="Detector-73"><a href="#Detector-73"><span class="linenos"> 73</span></a>    <span class="c1">## End of 3d orientation definition</span>
</span><span id="Detector-74"><a href="#Detector-74"><span class="linenos"> 74</span></a>    <span class="c1">## Start of points and vectors definitions</span>
</span><span id="Detector-75"><a href="#Detector-75"><span class="linenos"> 75</span></a>
</span><span id="Detector-76"><a href="#Detector-76"><span class="linenos"> 76</span></a>    <span class="nd">@property</span>
</span><span id="Detector-77"><a href="#Detector-77"><span class="linenos"> 77</span></a>    <span class="k">def</span> <span class="nf">refpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Detector-78"><a href="#Detector-78"><span class="linenos"> 78</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span>
</span><span id="Detector-79"><a href="#Detector-79"><span class="linenos"> 79</span></a>    
</span><span id="Detector-80"><a href="#Detector-80"><span class="linenos"> 80</span></a>    <span class="nd">@refpoint</span><span class="o">.</span><span class="n">setter</span>
</span><span id="Detector-81"><a href="#Detector-81"><span class="linenos"> 81</span></a>    <span class="k">def</span> <span class="nf">refpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NewRefPoint</span><span class="p">):</span>
</span><span id="Detector-82"><a href="#Detector-82"><span class="linenos"> 82</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewRefPoint</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">NewRefPoint</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="Detector-83"><a href="#Detector-83"><span class="linenos"> 83</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">NewRefPoint</span>
</span><span id="Detector-84"><a href="#Detector-84"><span class="linenos"> 84</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Detector-85"><a href="#Detector-85"><span class="linenos"> 85</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Reference Point must be a 3D numpy.ndarray.&quot;</span><span class="p">)</span>
</span><span id="Detector-86"><a href="#Detector-86"><span class="linenos"> 86</span></a>        
</span><span id="Detector-87"><a href="#Detector-87"><span class="linenos"> 87</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Detector-88"><a href="#Detector-88"><span class="linenos"> 88</span></a>    <span class="k">def</span> <span class="nf">centre</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Detector-89"><a href="#Detector-89"><span class="linenos"> 89</span></a>        <span class="k">pass</span>
</span><span id="Detector-90"><a href="#Detector-90"><span class="linenos"> 90</span></a>        
</span><span id="Detector-91"><a href="#Detector-91"><span class="linenos"> 91</span></a>    <span class="nd">@property</span>
</span><span id="Detector-92"><a href="#Detector-92"><span class="linenos"> 92</span></a>    <span class="k">def</span> <span class="nf">normal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Detector-93"><a href="#Detector-93"><span class="linenos"> 93</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">quaternion</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_normal</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span>
</span><span id="Detector-94"><a href="#Detector-94"><span class="linenos"> 94</span></a>    
</span><span id="Detector-95"><a href="#Detector-95"><span class="linenos"> 95</span></a>    <span class="c1">## End of points and vectors definitions</span>
</span><span id="Detector-96"><a href="#Detector-96"><span class="linenos"> 96</span></a>
</span><span id="Detector-97"><a href="#Detector-97"><span class="linenos"> 97</span></a>
</span><span id="Detector-98"><a href="#Detector-98"><span class="linenos"> 98</span></a>    
</span><span id="Detector-99"><a href="#Detector-99"><span class="linenos"> 99</span></a>    <span class="k">def</span> <span class="nf">get_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Detector-100"><a href="#Detector-100"><span class="linenos">100</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Detector-101"><a href="#Detector-101"><span class="linenos">101</span></a><span class="sd">        Return distance of the Detector from its reference point Detector.refpoint.</span>
</span><span id="Detector-102"><a href="#Detector-102"><span class="linenos">102</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Detector-103"><a href="#Detector-103"><span class="linenos">103</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refpoint</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">)</span>
</span><span id="Detector-104"><a href="#Detector-104"><span class="linenos">104</span></a>
</span><span id="Detector-105"><a href="#Detector-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="nf">shiftToDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NewDistance</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="Detector-106"><a href="#Detector-106"><span class="linenos">106</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Detector-107"><a href="#Detector-107"><span class="linenos">107</span></a><span class="sd">        Shift the Detector to the distance NewDistance from its reference point Detector.refpoint.</span>
</span><span id="Detector-108"><a href="#Detector-108"><span class="linenos">108</span></a>
</span><span id="Detector-109"><a href="#Detector-109"><span class="linenos">109</span></a><span class="sd">        Parameters</span>
</span><span id="Detector-110"><a href="#Detector-110"><span class="linenos">110</span></a><span class="sd">        ----------</span>
</span><span id="Detector-111"><a href="#Detector-111"><span class="linenos">111</span></a><span class="sd">            NewDistance : float</span>
</span><span id="Detector-112"><a href="#Detector-112"><span class="linenos">112</span></a><span class="sd">                The distance (absolute) to which to shift the Detector.</span>
</span><span id="Detector-113"><a href="#Detector-113"><span class="linenos">113</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Detector-114"><a href="#Detector-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="Detector-115"><a href="#Detector-115"><span class="linenos">115</span></a>            <span class="n">shiftby</span> <span class="o">=</span> <span class="n">NewDistance</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distance</span><span class="p">()</span>  <span class="c1"># by that much in the self.normal-direction</span>
</span><span id="Detector-116"><a href="#Detector-116"><span class="linenos">116</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Detector-117"><a href="#Detector-117"><span class="linenos">117</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The new Detector Distance must be int or float.&quot;</span><span class="p">)</span>
</span><span id="Detector-118"><a href="#Detector-118"><span class="linenos">118</span></a>
</span><span id="Detector-119"><a href="#Detector-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">+=</span> <span class="o">-</span><span class="n">shiftby</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span>
</span><span id="Detector-120"><a href="#Detector-120"><span class="linenos">120</span></a>
</span><span id="Detector-121"><a href="#Detector-121"><span class="linenos">121</span></a>    <span class="k">def</span> <span class="nf">shiftByDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Shift</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="Detector-122"><a href="#Detector-122"><span class="linenos">122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Detector-123"><a href="#Detector-123"><span class="linenos">123</span></a><span class="sd">        Shift the Detector *by* the distance Shift along its normal vector Detector.normal.</span>
</span><span id="Detector-124"><a href="#Detector-124"><span class="linenos">124</span></a>
</span><span id="Detector-125"><a href="#Detector-125"><span class="linenos">125</span></a><span class="sd">        Parameters</span>
</span><span id="Detector-126"><a href="#Detector-126"><span class="linenos">126</span></a><span class="sd">        ----------</span>
</span><span id="Detector-127"><a href="#Detector-127"><span class="linenos">127</span></a><span class="sd">            Shift : float</span>
</span><span id="Detector-128"><a href="#Detector-128"><span class="linenos">128</span></a><span class="sd">                The distance (relative) *by* which to shift the Detector.</span>
</span><span id="Detector-129"><a href="#Detector-129"><span class="linenos">129</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Detector-130"><a href="#Detector-130"><span class="linenos">130</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="Detector-131"><a href="#Detector-131"><span class="linenos">131</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">-</span> <span class="n">Shift</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span>  <span class="c1"># directly set _centre, i.e. circumvent setter</span>
</span><span id="Detector-132"><a href="#Detector-132"><span class="linenos">132</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Detector-133"><a href="#Detector-133"><span class="linenos">133</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The Detector Distance Shift must be int or float.&quot;</span><span class="p">)</span>
</span><span id="Detector-134"><a href="#Detector-134"><span class="linenos">134</span></a>
</span><span id="Detector-135"><a href="#Detector-135"><span class="linenos">135</span></a>
</span><span id="Detector-136"><a href="#Detector-136"><span class="linenos">136</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Detector-137"><a href="#Detector-137"><span class="linenos">137</span></a>    <span class="k">def</span> <span class="nf">get_2D_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">):</span>
</span><span id="Detector-138"><a href="#Detector-138"><span class="linenos">138</span></a>        <span class="k">pass</span>
</span><span id="Detector-139"><a href="#Detector-139"><span class="linenos">139</span></a>
</span><span id="Detector-140"><a href="#Detector-140"><span class="linenos">140</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Detector-141"><a href="#Detector-141"><span class="linenos">141</span></a>    <span class="k">def</span> <span class="nf">get_3D_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">):</span>
</span><span id="Detector-142"><a href="#Detector-142"><span class="linenos">142</span></a>        <span class="k">pass</span>
</span><span id="Detector-143"><a href="#Detector-143"><span class="linenos">143</span></a>
</span><span id="Detector-144"><a href="#Detector-144"><span class="linenos">144</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Detector-145"><a href="#Detector-145"><span class="linenos">145</span></a>    <span class="k">def</span> <span class="nf">_copy_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Detector-146"><a href="#Detector-146"><span class="linenos">146</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Abstract class describing a detector and the properties/methods it has to have.</p>
</div>


                            <div id="Detector.r" class="classattr">
                                        <input id="Detector.r-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">r</span>

                <label class="view-source-button" for="Detector.r-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Detector.r"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="Detector.r-40"><a href="#Detector.r-40"><span class="linenos">40</span></a>    <span class="nd">@property</span>
</span><span id="Detector.r-41"><a href="#Detector.r-41"><span class="linenos">41</span></a>    <span class="k">def</span> <span class="nf">r</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Detector.r-42"><a href="#Detector.r-42"><span class="linenos">42</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r</span>
</span></pre></div>


    

                            </div>
                            <div id="Detector.q" class="classattr">
                                        <input id="Detector.q-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">q</span>

                <label class="view-source-button" for="Detector.q-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Detector.q"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="Detector.q-51"><a href="#Detector.q-51"><span class="linenos">51</span></a>    <span class="nd">@property</span>
</span><span id="Detector.q-52"><a href="#Detector.q-52"><span class="linenos">52</span></a>    <span class="k">def</span> <span class="nf">q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Detector.q-53"><a href="#Detector.q-53"><span class="linenos">53</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q</span>
</span></pre></div>


    

                            </div>
                            <div id="Detector.basepoint" class="classattr">
                                        <input id="Detector.basepoint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">basepoint</span>

                <label class="view-source-button" for="Detector.basepoint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Detector.basepoint"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="Detector.basepoint-62"><a href="#Detector.basepoint-62"><span class="linenos">62</span></a>    <span class="nd">@property</span>
</span><span id="Detector.basepoint-63"><a href="#Detector.basepoint-63"><span class="linenos">63</span></a>    <span class="k">def</span> <span class="nf">basepoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Detector.basepoint-64"><a href="#Detector.basepoint-64"><span class="linenos">64</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basepoint_ref</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span>
</span></pre></div>


    

                            </div>
                            <div id="Detector.refpoint" class="classattr">
                                        <input id="Detector.refpoint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">refpoint</span>

                <label class="view-source-button" for="Detector.refpoint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Detector.refpoint"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="Detector.refpoint-76"><a href="#Detector.refpoint-76"><span class="linenos">76</span></a>    <span class="nd">@property</span>
</span><span id="Detector.refpoint-77"><a href="#Detector.refpoint-77"><span class="linenos">77</span></a>    <span class="k">def</span> <span class="nf">refpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Detector.refpoint-78"><a href="#Detector.refpoint-78"><span class="linenos">78</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span>
</span></pre></div>


    

                            </div>
                            <div id="Detector.centre" class="classattr">
                                        <input id="Detector.centre-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">centre</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Detector.centre-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Detector.centre"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="Detector.centre-87"><a href="#Detector.centre-87"><span class="linenos">87</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Detector.centre-88"><a href="#Detector.centre-88"><span class="linenos">88</span></a>    <span class="k">def</span> <span class="nf">centre</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Detector.centre-89"><a href="#Detector.centre-89"><span class="linenos">89</span></a>        <span class="k">pass</span>
</span></pre></div>


    

                            </div>
                            <div id="Detector.normal" class="classattr">
                                        <input id="Detector.normal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">normal</span>

                <label class="view-source-button" for="Detector.normal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Detector.normal"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="Detector.normal-91"><a href="#Detector.normal-91"><span class="linenos">91</span></a>    <span class="nd">@property</span>
</span><span id="Detector.normal-92"><a href="#Detector.normal-92"><span class="linenos">92</span></a>    <span class="k">def</span> <span class="nf">normal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Detector.normal-93"><a href="#Detector.normal-93"><span class="linenos">93</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">quaternion</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_normal</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="Detector.get_distance" class="classattr">
                                        <input id="Detector.get_distance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_distance</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Detector.get_distance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Detector.get_distance"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="Detector.get_distance-99"><a href="#Detector.get_distance-99"><span class="linenos"> 99</span></a>    <span class="k">def</span> <span class="nf">get_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Detector.get_distance-100"><a href="#Detector.get_distance-100"><span class="linenos">100</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Detector.get_distance-101"><a href="#Detector.get_distance-101"><span class="linenos">101</span></a><span class="sd">        Return distance of the Detector from its reference point Detector.refpoint.</span>
</span><span id="Detector.get_distance-102"><a href="#Detector.get_distance-102"><span class="linenos">102</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Detector.get_distance-103"><a href="#Detector.get_distance-103"><span class="linenos">103</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refpoint</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return distance of the Detector from its reference point <a href="#Detector.refpoint">Detector.refpoint</a>.</p>
</div>


                            </div>
                            <div id="Detector.shiftToDistance" class="classattr">
                                        <input id="Detector.shiftToDistance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">shiftToDistance</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">NewDistance</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Detector.shiftToDistance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Detector.shiftToDistance"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="Detector.shiftToDistance-105"><a href="#Detector.shiftToDistance-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="nf">shiftToDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NewDistance</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="Detector.shiftToDistance-106"><a href="#Detector.shiftToDistance-106"><span class="linenos">106</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Detector.shiftToDistance-107"><a href="#Detector.shiftToDistance-107"><span class="linenos">107</span></a><span class="sd">        Shift the Detector to the distance NewDistance from its reference point Detector.refpoint.</span>
</span><span id="Detector.shiftToDistance-108"><a href="#Detector.shiftToDistance-108"><span class="linenos">108</span></a>
</span><span id="Detector.shiftToDistance-109"><a href="#Detector.shiftToDistance-109"><span class="linenos">109</span></a><span class="sd">        Parameters</span>
</span><span id="Detector.shiftToDistance-110"><a href="#Detector.shiftToDistance-110"><span class="linenos">110</span></a><span class="sd">        ----------</span>
</span><span id="Detector.shiftToDistance-111"><a href="#Detector.shiftToDistance-111"><span class="linenos">111</span></a><span class="sd">            NewDistance : float</span>
</span><span id="Detector.shiftToDistance-112"><a href="#Detector.shiftToDistance-112"><span class="linenos">112</span></a><span class="sd">                The distance (absolute) to which to shift the Detector.</span>
</span><span id="Detector.shiftToDistance-113"><a href="#Detector.shiftToDistance-113"><span class="linenos">113</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Detector.shiftToDistance-114"><a href="#Detector.shiftToDistance-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="Detector.shiftToDistance-115"><a href="#Detector.shiftToDistance-115"><span class="linenos">115</span></a>            <span class="n">shiftby</span> <span class="o">=</span> <span class="n">NewDistance</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distance</span><span class="p">()</span>  <span class="c1"># by that much in the self.normal-direction</span>
</span><span id="Detector.shiftToDistance-116"><a href="#Detector.shiftToDistance-116"><span class="linenos">116</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Detector.shiftToDistance-117"><a href="#Detector.shiftToDistance-117"><span class="linenos">117</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The new Detector Distance must be int or float.&quot;</span><span class="p">)</span>
</span><span id="Detector.shiftToDistance-118"><a href="#Detector.shiftToDistance-118"><span class="linenos">118</span></a>
</span><span id="Detector.shiftToDistance-119"><a href="#Detector.shiftToDistance-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">+=</span> <span class="o">-</span><span class="n">shiftby</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span>
</span></pre></div>


            <div class="docstring"><p>Shift the Detector to the distance NewDistance from its reference point <a href="#Detector.refpoint">Detector.refpoint</a>.</p>

<h2 id="parameters">Parameters</h2>

<pre><code>NewDistance : float
    The distance (absolute) to which to shift the Detector.
</code></pre>
</div>


                            </div>
                            <div id="Detector.shiftByDistance" class="classattr">
                                        <input id="Detector.shiftByDistance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">shiftByDistance</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">Shift</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Detector.shiftByDistance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Detector.shiftByDistance"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="Detector.shiftByDistance-121"><a href="#Detector.shiftByDistance-121"><span class="linenos">121</span></a>    <span class="k">def</span> <span class="nf">shiftByDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Shift</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="Detector.shiftByDistance-122"><a href="#Detector.shiftByDistance-122"><span class="linenos">122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Detector.shiftByDistance-123"><a href="#Detector.shiftByDistance-123"><span class="linenos">123</span></a><span class="sd">        Shift the Detector *by* the distance Shift along its normal vector Detector.normal.</span>
</span><span id="Detector.shiftByDistance-124"><a href="#Detector.shiftByDistance-124"><span class="linenos">124</span></a>
</span><span id="Detector.shiftByDistance-125"><a href="#Detector.shiftByDistance-125"><span class="linenos">125</span></a><span class="sd">        Parameters</span>
</span><span id="Detector.shiftByDistance-126"><a href="#Detector.shiftByDistance-126"><span class="linenos">126</span></a><span class="sd">        ----------</span>
</span><span id="Detector.shiftByDistance-127"><a href="#Detector.shiftByDistance-127"><span class="linenos">127</span></a><span class="sd">            Shift : float</span>
</span><span id="Detector.shiftByDistance-128"><a href="#Detector.shiftByDistance-128"><span class="linenos">128</span></a><span class="sd">                The distance (relative) *by* which to shift the Detector.</span>
</span><span id="Detector.shiftByDistance-129"><a href="#Detector.shiftByDistance-129"><span class="linenos">129</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Detector.shiftByDistance-130"><a href="#Detector.shiftByDistance-130"><span class="linenos">130</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="Detector.shiftByDistance-131"><a href="#Detector.shiftByDistance-131"><span class="linenos">131</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">-</span> <span class="n">Shift</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span>  <span class="c1"># directly set _centre, i.e. circumvent setter</span>
</span><span id="Detector.shiftByDistance-132"><a href="#Detector.shiftByDistance-132"><span class="linenos">132</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Detector.shiftByDistance-133"><a href="#Detector.shiftByDistance-133"><span class="linenos">133</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The Detector Distance Shift must be int or float.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Shift the Detector <em>by</em> the distance Shift along its normal vector <a href="#Detector.normal">Detector.normal</a>.</p>

<h2 id="parameters">Parameters</h2>

<pre><code>Shift : float
    The distance (relative) *by* which to shift the Detector.
</code></pre>
</div>


                            </div>
                            <div id="Detector.get_2D_points" class="classattr">
                                        <input id="Detector.get_2D_points-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">get_2D_points</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">RayList</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Detector.get_2D_points-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Detector.get_2D_points"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="Detector.get_2D_points-136"><a href="#Detector.get_2D_points-136"><span class="linenos">136</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Detector.get_2D_points-137"><a href="#Detector.get_2D_points-137"><span class="linenos">137</span></a>    <span class="k">def</span> <span class="nf">get_2D_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">):</span>
</span><span id="Detector.get_2D_points-138"><a href="#Detector.get_2D_points-138"><span class="linenos">138</span></a>        <span class="k">pass</span>
</span></pre></div>


    

                            </div>
                            <div id="Detector.get_3D_points" class="classattr">
                                        <input id="Detector.get_3D_points-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">get_3D_points</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">RayList</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Detector.get_3D_points-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Detector.get_3D_points"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="Detector.get_3D_points-140"><a href="#Detector.get_3D_points-140"><span class="linenos">140</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Detector.get_3D_points-141"><a href="#Detector.get_3D_points-141"><span class="linenos">141</span></a>    <span class="k">def</span> <span class="nf">get_3D_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">):</span>
</span><span id="Detector.get_3D_points-142"><a href="#Detector.get_3D_points-142"><span class="linenos">142</span></a>        <span class="k">pass</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="InfiniteDetector">
                            <input id="InfiniteDetector-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">InfiniteDetector</span><wbr>(<span class="base"><a href="#Detector">Detector</a></span>):

                <label class="view-source-button" for="InfiniteDetector-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfiniteDetector"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="InfiniteDetector-150"><a href="#InfiniteDetector-150"><span class="linenos">150</span></a><span class="k">class</span> <span class="nc">InfiniteDetector</span><span class="p">(</span><span class="n">Detector</span><span class="p">):</span>
</span><span id="InfiniteDetector-151"><a href="#InfiniteDetector-151"><span class="linenos">151</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-152"><a href="#InfiniteDetector-152"><span class="linenos">152</span></a><span class="sd">    A detector is simply a plane in 3D-lab-space.</span>
</span><span id="InfiniteDetector-153"><a href="#InfiniteDetector-153"><span class="linenos">153</span></a><span class="sd">    It is defined by a point Detector.centre and its</span>
</span><span id="InfiniteDetector-154"><a href="#InfiniteDetector-154"><span class="linenos">154</span></a><span class="sd">    orientation Detector.orientation (a quaternion rotating it from the initial alignment)</span>
</span><span id="InfiniteDetector-155"><a href="#InfiniteDetector-155"><span class="linenos">155</span></a><span class="sd">    These are optional arguments when creating a Detector-instance, because they can</span>
</span><span id="InfiniteDetector-156"><a href="#InfiniteDetector-156"><span class="linenos">156</span></a><span class="sd">    later be set automatically by the method Detector.autoplace().</span>
</span><span id="InfiniteDetector-157"><a href="#InfiniteDetector-157"><span class="linenos">157</span></a><span class="sd">    The Detector has a reference point &quot;RefPoint&quot;, with respect to which a distance</span>
</span><span id="InfiniteDetector-158"><a href="#InfiniteDetector-158"><span class="linenos">158</span></a><span class="sd">    can be returned via the method Detector.get distance.</span>
</span><span id="InfiniteDetector-159"><a href="#InfiniteDetector-159"><span class="linenos">159</span></a>
</span><span id="InfiniteDetector-160"><a href="#InfiniteDetector-160"><span class="linenos">160</span></a><span class="sd">    Attributes</span>
</span><span id="InfiniteDetector-161"><a href="#InfiniteDetector-161"><span class="linenos">161</span></a><span class="sd">    ----------</span>
</span><span id="InfiniteDetector-162"><a href="#InfiniteDetector-162"><span class="linenos">162</span></a><span class="sd">        centre : np.ndarray</span>
</span><span id="InfiniteDetector-163"><a href="#InfiniteDetector-163"><span class="linenos">163</span></a><span class="sd">            3D Point in the Detector plane.</span>
</span><span id="InfiniteDetector-164"><a href="#InfiniteDetector-164"><span class="linenos">164</span></a>
</span><span id="InfiniteDetector-165"><a href="#InfiniteDetector-165"><span class="linenos">165</span></a><span class="sd">        normal : np.ndarray</span>
</span><span id="InfiniteDetector-166"><a href="#InfiniteDetector-166"><span class="linenos">166</span></a><span class="sd">           3D Normal vector on the Detector plane.</span>
</span><span id="InfiniteDetector-167"><a href="#InfiniteDetector-167"><span class="linenos">167</span></a>
</span><span id="InfiniteDetector-168"><a href="#InfiniteDetector-168"><span class="linenos">168</span></a><span class="sd">        refpoint : np.ndarray</span>
</span><span id="InfiniteDetector-169"><a href="#InfiniteDetector-169"><span class="linenos">169</span></a><span class="sd">            3D reference point from which to measure the Detector distance.</span>
</span><span id="InfiniteDetector-170"><a href="#InfiniteDetector-170"><span class="linenos">170</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-171"><a href="#InfiniteDetector-171"><span class="linenos">171</span></a>
</span><span id="InfiniteDetector-172"><a href="#InfiniteDetector-172"><span class="linenos">172</span></a>    <span class="nd">@singledispatchmethod</span>
</span><span id="InfiniteDetector-173"><a href="#InfiniteDetector-173"><span class="linenos">173</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Orientation</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">quaternion</span><span class="p">,</span> <span class="n">Centre</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">RefPoint</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="InfiniteDetector-174"><a href="#InfiniteDetector-174"><span class="linenos">174</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-175"><a href="#InfiniteDetector-175"><span class="linenos">175</span></a><span class="sd">        Parameters</span>
</span><span id="InfiniteDetector-176"><a href="#InfiniteDetector-176"><span class="linenos">176</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector-177"><a href="#InfiniteDetector-177"><span class="linenos">177</span></a><span class="sd">            Orientation : np.quaternion</span>
</span><span id="InfiniteDetector-178"><a href="#InfiniteDetector-178"><span class="linenos">178</span></a><span class="sd">               Quaternion describing rotation from initial orientation (x-axis along x axis, normal towards positive z).</span>
</span><span id="InfiniteDetector-179"><a href="#InfiniteDetector-179"><span class="linenos">179</span></a>
</span><span id="InfiniteDetector-180"><a href="#InfiniteDetector-180"><span class="linenos">180</span></a><span class="sd">            Centre : np.ndarray</span>
</span><span id="InfiniteDetector-181"><a href="#InfiniteDetector-181"><span class="linenos">181</span></a><span class="sd">               3D Point in the Detector plane.</span>
</span><span id="InfiniteDetector-182"><a href="#InfiniteDetector-182"><span class="linenos">182</span></a>
</span><span id="InfiniteDetector-183"><a href="#InfiniteDetector-183"><span class="linenos">183</span></a><span class="sd">            RefPoint : np.ndarray, optional</span>
</span><span id="InfiniteDetector-184"><a href="#InfiniteDetector-184"><span class="linenos">184</span></a><span class="sd">                3D Reference point from which to measure the Detector distance.</span>
</span><span id="InfiniteDetector-185"><a href="#InfiniteDetector-185"><span class="linenos">185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-186"><a href="#InfiniteDetector-186"><span class="linenos">186</span></a>        <span class="n">Centre</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">Centre</span><span class="p">)</span>
</span><span id="InfiniteDetector-187"><a href="#InfiniteDetector-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="InfiniteDetector-188"><a href="#InfiniteDetector-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">Orientation</span>
</span><span id="InfiniteDetector-189"><a href="#InfiniteDetector-189"><span class="linenos">189</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">RefPoint</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">RefPoint</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
</span><span id="InfiniteDetector-190"><a href="#InfiniteDetector-190"><span class="linenos">190</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">RefPoint</span><span class="p">)</span>
</span><span id="InfiniteDetector-191"><a href="#InfiniteDetector-191"><span class="linenos">191</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector-192"><a href="#InfiniteDetector-192"><span class="linenos">192</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="InfiniteDetector-193"><a href="#InfiniteDetector-193"><span class="linenos">193</span></a>
</span><span id="InfiniteDetector-194"><a href="#InfiniteDetector-194"><span class="linenos">194</span></a>    <span class="nd">@__init__</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
</span><span id="InfiniteDetector-195"><a href="#InfiniteDetector-195"><span class="linenos">195</span></a>    <span class="k">def</span> <span class="nf">_from_normal_and_centre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Normal</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Centre</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">RefPoint</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">IncidencePlane</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="InfiniteDetector-196"><a href="#InfiniteDetector-196"><span class="linenos">196</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using normal vector to orient detector&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector-197"><a href="#InfiniteDetector-197"><span class="linenos">197</span></a>        <span class="n">Centre</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="InfiniteDetector-198"><a href="#InfiniteDetector-198"><span class="linenos">198</span></a>        <span class="n">Normal</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">Normal</span><span class="p">)</span>
</span><span id="InfiniteDetector-199"><a href="#InfiniteDetector-199"><span class="linenos">199</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">RefPoint</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">RefPoint</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
</span><span id="InfiniteDetector-200"><a href="#InfiniteDetector-200"><span class="linenos">200</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">RefPoint</span><span class="p">)</span>
</span><span id="InfiniteDetector-201"><a href="#InfiniteDetector-201"><span class="linenos">201</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector-202"><a href="#InfiniteDetector-202"><span class="linenos">202</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="InfiniteDetector-203"><a href="#InfiniteDetector-203"><span class="linenos">203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="InfiniteDetector-204"><a href="#InfiniteDetector-204"><span class="linenos">204</span></a>        <span class="k">if</span> <span class="n">IncidencePlane</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="InfiniteDetector-205"><a href="#InfiniteDetector-205"><span class="linenos">205</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Registering a detector based only on the normal vector is not recommended.&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector-206"><a href="#InfiniteDetector-206"><span class="linenos">206</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">QRotationVector2Vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">Normal</span><span class="p">)</span>
</span><span id="InfiniteDetector-207"><a href="#InfiniteDetector-207"><span class="linenos">207</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector-208"><a href="#InfiniteDetector-208"><span class="linenos">208</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">IncidencePlane</span><span class="p">,</span> <span class="n">Normal</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">:</span>
</span><span id="InfiniteDetector-209"><a href="#InfiniteDetector-209"><span class="linenos">209</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Attempting to define a detector based on a normal and an incidence plane, however normal is not within incidence plane. Therefore, not using the incidence plane.&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector-210"><a href="#InfiniteDetector-210"><span class="linenos">210</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">QRotationVector2Vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">Normal</span><span class="p">)</span>
</span><span id="InfiniteDetector-211"><a href="#InfiniteDetector-211"><span class="linenos">211</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector-212"><a href="#InfiniteDetector-212"><span class="linenos">212</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">QRotationVectorPair2VectorPair</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="n">IncidencePlane</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">Normal</span><span class="p">)</span>
</span><span id="InfiniteDetector-213"><a href="#InfiniteDetector-213"><span class="linenos">213</span></a>    
</span><span id="InfiniteDetector-214"><a href="#InfiniteDetector-214"><span class="linenos">214</span></a>    <span class="nd">@__init__</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">mray</span><span class="o">.</span><span class="n">Ray</span><span class="p">)</span>
</span><span id="InfiniteDetector-215"><a href="#InfiniteDetector-215"><span class="linenos">215</span></a>    <span class="k">def</span> <span class="nf">_from_ray_and_centre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Ray</span><span class="p">:</span><span class="n">mray</span><span class="o">.</span><span class="n">Ray</span><span class="p">,</span> <span class="n">Centre</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">RefPoint</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">IncidencePlane</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="InfiniteDetector-216"><a href="#InfiniteDetector-216"><span class="linenos">216</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using ray to orient detector&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector-217"><a href="#InfiniteDetector-217"><span class="linenos">217</span></a>        <span class="n">Centre</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="InfiniteDetector-218"><a href="#InfiniteDetector-218"><span class="linenos">218</span></a>        <span class="n">Normal</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">Ray</span><span class="o">.</span><span class="n">vector</span><span class="p">)</span>
</span><span id="InfiniteDetector-219"><a href="#InfiniteDetector-219"><span class="linenos">219</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">RefPoint</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">RefPoint</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
</span><span id="InfiniteDetector-220"><a href="#InfiniteDetector-220"><span class="linenos">220</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">RefPoint</span><span class="p">)</span>
</span><span id="InfiniteDetector-221"><a href="#InfiniteDetector-221"><span class="linenos">221</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector-222"><a href="#InfiniteDetector-222"><span class="linenos">222</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">Ray</span><span class="o">.</span><span class="n">point</span>
</span><span id="InfiniteDetector-223"><a href="#InfiniteDetector-223"><span class="linenos">223</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="InfiniteDetector-224"><a href="#InfiniteDetector-224"><span class="linenos">224</span></a>        <span class="k">if</span> <span class="n">IncidencePlane</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="InfiniteDetector-225"><a href="#InfiniteDetector-225"><span class="linenos">225</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Registering a detector based only on the normal vector is not recommended.&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector-226"><a href="#InfiniteDetector-226"><span class="linenos">226</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">QRotationVector2Vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">Normal</span><span class="p">)</span>
</span><span id="InfiniteDetector-227"><a href="#InfiniteDetector-227"><span class="linenos">227</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector-228"><a href="#InfiniteDetector-228"><span class="linenos">228</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">IncidencePlane</span><span class="p">,</span> <span class="n">Normal</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">:</span>
</span><span id="InfiniteDetector-229"><a href="#InfiniteDetector-229"><span class="linenos">229</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Attempting to define a detector based on a normal and an incidence plane, however normal is not within incidence plane. Therefore, not using the incidence plane.&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector-230"><a href="#InfiniteDetector-230"><span class="linenos">230</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">QRotationVector2Vector</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="n">Normal</span><span class="p">)</span>
</span><span id="InfiniteDetector-231"><a href="#InfiniteDetector-231"><span class="linenos">231</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector-232"><a href="#InfiniteDetector-232"><span class="linenos">232</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">QRotationVectorPair2VectorPair</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="n">IncidencePlane</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">Normal</span><span class="p">)</span>
</span><span id="InfiniteDetector-233"><a href="#InfiniteDetector-233"><span class="linenos">233</span></a>
</span><span id="InfiniteDetector-234"><a href="#InfiniteDetector-234"><span class="linenos">234</span></a>    <span class="nd">@property</span>
</span><span id="InfiniteDetector-235"><a href="#InfiniteDetector-235"><span class="linenos">235</span></a>    <span class="k">def</span> <span class="nf">centre</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="InfiniteDetector-236"><a href="#InfiniteDetector-236"><span class="linenos">236</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span>
</span><span id="InfiniteDetector-237"><a href="#InfiniteDetector-237"><span class="linenos">237</span></a>
</span><span id="InfiniteDetector-238"><a href="#InfiniteDetector-238"><span class="linenos">238</span></a>    <span class="c1"># a setter function</span>
</span><span id="InfiniteDetector-239"><a href="#InfiniteDetector-239"><span class="linenos">239</span></a>    <span class="nd">@centre</span><span class="o">.</span><span class="n">setter</span>
</span><span id="InfiniteDetector-240"><a href="#InfiniteDetector-240"><span class="linenos">240</span></a>    <span class="k">def</span> <span class="nf">centre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Centre</span><span class="p">):</span>
</span><span id="InfiniteDetector-241"><a href="#InfiniteDetector-241"><span class="linenos">241</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Centre</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="ow">and</span> <span class="n">Centre</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
</span><span id="InfiniteDetector-242"><a href="#InfiniteDetector-242"><span class="linenos">242</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="InfiniteDetector-243"><a href="#InfiniteDetector-243"><span class="linenos">243</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector-244"><a href="#InfiniteDetector-244"><span class="linenos">244</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Detector Centre must be a 3D-vector, given as numpy.ndarray of shape (3,).&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector-245"><a href="#InfiniteDetector-245"><span class="linenos">245</span></a>
</span><span id="InfiniteDetector-246"><a href="#InfiniteDetector-246"><span class="linenos">246</span></a>    <span class="nd">@property</span>
</span><span id="InfiniteDetector-247"><a href="#InfiniteDetector-247"><span class="linenos">247</span></a>    <span class="k">def</span> <span class="nf">orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="InfiniteDetector-248"><a href="#InfiniteDetector-248"><span class="linenos">248</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span>
</span><span id="InfiniteDetector-249"><a href="#InfiniteDetector-249"><span class="linenos">249</span></a>    
</span><span id="InfiniteDetector-250"><a href="#InfiniteDetector-250"><span class="linenos">250</span></a>    <span class="nd">@orientation</span><span class="o">.</span><span class="n">setter</span>
</span><span id="InfiniteDetector-251"><a href="#InfiniteDetector-251"><span class="linenos">251</span></a>    <span class="k">def</span> <span class="nf">orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Orientation</span><span class="p">):</span>
</span><span id="InfiniteDetector-252"><a href="#InfiniteDetector-252"><span class="linenos">252</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Orientation</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">quaternion</span><span class="p">):</span>
</span><span id="InfiniteDetector-253"><a href="#InfiniteDetector-253"><span class="linenos">253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">Orientation</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
</span><span id="InfiniteDetector-254"><a href="#InfiniteDetector-254"><span class="linenos">254</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector-255"><a href="#InfiniteDetector-255"><span class="linenos">255</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Detector Orientation must be a Quaternion&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector-256"><a href="#InfiniteDetector-256"><span class="linenos">256</span></a>
</span><span id="InfiniteDetector-257"><a href="#InfiniteDetector-257"><span class="linenos">257</span></a>    <span class="nd">@property</span>
</span><span id="InfiniteDetector-258"><a href="#InfiniteDetector-258"><span class="linenos">258</span></a>    <span class="k">def</span> <span class="nf">normal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="InfiniteDetector-259"><a href="#InfiniteDetector-259"><span class="linenos">259</span></a>        <span class="n">internal_normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
</span><span id="InfiniteDetector-260"><a href="#InfiniteDetector-260"><span class="linenos">260</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">quaternion</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">internal_normal</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span><span class="o">.</span><span class="n">imag</span>
</span><span id="InfiniteDetector-261"><a href="#InfiniteDetector-261"><span class="linenos">261</span></a>
</span><span id="InfiniteDetector-262"><a href="#InfiniteDetector-262"><span class="linenos">262</span></a>    <span class="nd">@property</span>
</span><span id="InfiniteDetector-263"><a href="#InfiniteDetector-263"><span class="linenos">263</span></a>    <span class="k">def</span> <span class="nf">refpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="InfiniteDetector-264"><a href="#InfiniteDetector-264"><span class="linenos">264</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span>
</span><span id="InfiniteDetector-265"><a href="#InfiniteDetector-265"><span class="linenos">265</span></a>
</span><span id="InfiniteDetector-266"><a href="#InfiniteDetector-266"><span class="linenos">266</span></a>    <span class="c1"># a setter function</span>
</span><span id="InfiniteDetector-267"><a href="#InfiniteDetector-267"><span class="linenos">267</span></a>    <span class="nd">@refpoint</span><span class="o">.</span><span class="n">setter</span>
</span><span id="InfiniteDetector-268"><a href="#InfiniteDetector-268"><span class="linenos">268</span></a>    <span class="k">def</span> <span class="nf">refpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RefPoint</span><span class="p">):</span>
</span><span id="InfiniteDetector-269"><a href="#InfiniteDetector-269"><span class="linenos">269</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">RefPoint</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="ow">and</span> <span class="n">RefPoint</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
</span><span id="InfiniteDetector-270"><a href="#InfiniteDetector-270"><span class="linenos">270</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">RefPoint</span>
</span><span id="InfiniteDetector-271"><a href="#InfiniteDetector-271"><span class="linenos">271</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector-272"><a href="#InfiniteDetector-272"><span class="linenos">272</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Detector RefPoint must a 3D-vector, given as numpy.ndarray of shape (3,).&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector-273"><a href="#InfiniteDetector-273"><span class="linenos">273</span></a>
</span><span id="InfiniteDetector-274"><a href="#InfiniteDetector-274"><span class="linenos">274</span></a>    <span class="c1"># %% METHODS FOR PLACING THE DETECTOR ##################################################################</span>
</span><span id="InfiniteDetector-275"><a href="#InfiniteDetector-275"><span class="linenos">275</span></a>
</span><span id="InfiniteDetector-276"><a href="#InfiniteDetector-276"><span class="linenos">276</span></a>    <span class="k">def</span> <span class="nf">copy_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="InfiniteDetector-277"><a href="#InfiniteDetector-277"><span class="linenos">277</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-278"><a href="#InfiniteDetector-278"><span class="linenos">278</span></a><span class="sd">        Returns a new Detector object with the same properties.</span>
</span><span id="InfiniteDetector-279"><a href="#InfiniteDetector-279"><span class="linenos">279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-280"><a href="#InfiniteDetector-280"><span class="linenos">280</span></a>        <span class="k">return</span> <span class="n">Detector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refpoint</span><span class="p">)</span>
</span><span id="InfiniteDetector-281"><a href="#InfiniteDetector-281"><span class="linenos">281</span></a>
</span><span id="InfiniteDetector-282"><a href="#InfiniteDetector-282"><span class="linenos">282</span></a>    <span class="k">def</span> <span class="nf">autoplace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">,</span> <span class="n">DistanceDetector</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="InfiniteDetector-283"><a href="#InfiniteDetector-283"><span class="linenos">283</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-284"><a href="#InfiniteDetector-284"><span class="linenos">284</span></a><span class="sd">        Automatically place and orient the detector such that it is normal to the central ray</span>
</span><span id="InfiniteDetector-285"><a href="#InfiniteDetector-285"><span class="linenos">285</span></a><span class="sd">        of the supplied RayList, at the distance DistanceDetector the origin point of that central ray.</span>
</span><span id="InfiniteDetector-286"><a href="#InfiniteDetector-286"><span class="linenos">286</span></a>
</span><span id="InfiniteDetector-287"><a href="#InfiniteDetector-287"><span class="linenos">287</span></a><span class="sd">        Parameters</span>
</span><span id="InfiniteDetector-288"><a href="#InfiniteDetector-288"><span class="linenos">288</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector-289"><a href="#InfiniteDetector-289"><span class="linenos">289</span></a><span class="sd">            RayList : list[Ray]</span>
</span><span id="InfiniteDetector-290"><a href="#InfiniteDetector-290"><span class="linenos">290</span></a><span class="sd">                A list of objects of the ModuleOpticalRay.Ray-class.</span>
</span><span id="InfiniteDetector-291"><a href="#InfiniteDetector-291"><span class="linenos">291</span></a>
</span><span id="InfiniteDetector-292"><a href="#InfiniteDetector-292"><span class="linenos">292</span></a><span class="sd">            DistanceDetector : float</span>
</span><span id="InfiniteDetector-293"><a href="#InfiniteDetector-293"><span class="linenos">293</span></a><span class="sd">                The distance at which to place the Detector.</span>
</span><span id="InfiniteDetector-294"><a href="#InfiniteDetector-294"><span class="linenos">294</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-295"><a href="#InfiniteDetector-295"><span class="linenos">295</span></a>        <span class="n">CentralRay</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">FindCentralRay</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="InfiniteDetector-296"><a href="#InfiniteDetector-296"><span class="linenos">296</span></a>        <span class="n">CentralRay</span> <span class="o">=</span> <span class="n">RayList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="InfiniteDetector-297"><a href="#InfiniteDetector-297"><span class="linenos">297</span></a>        <span class="k">if</span> <span class="n">CentralRay</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="InfiniteDetector-298"><a href="#InfiniteDetector-298"><span class="linenos">298</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find central ray! The list of rays has a length of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector-299"><a href="#InfiniteDetector-299"><span class="linenos">299</span></a>            <span class="n">CentralPoint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="InfiniteDetector-300"><a href="#InfiniteDetector-300"><span class="linenos">300</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">RayList</span><span class="p">:</span>
</span><span id="InfiniteDetector-301"><a href="#InfiniteDetector-301"><span class="linenos">301</span></a>                <span class="n">CentralPoint</span> <span class="o">=</span> <span class="n">CentralPoint</span> <span class="o">+</span> <span class="n">k</span><span class="o">.</span><span class="n">point</span>
</span><span id="InfiniteDetector-302"><a href="#InfiniteDetector-302"><span class="linenos">302</span></a>            <span class="n">CentralPoint</span> <span class="o">=</span> <span class="n">CentralPoint</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="InfiniteDetector-303"><a href="#InfiniteDetector-303"><span class="linenos">303</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector-304"><a href="#InfiniteDetector-304"><span class="linenos">304</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found central ray, using it to position detector: </span><span class="se">\n</span><span class="si">{</span><span class="n">CentralRay</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector-305"><a href="#InfiniteDetector-305"><span class="linenos">305</span></a>            <span class="n">CentralPoint</span> <span class="o">=</span> <span class="n">CentralRay</span><span class="o">.</span><span class="n">point</span>
</span><span id="InfiniteDetector-306"><a href="#InfiniteDetector-306"><span class="linenos">306</span></a>
</span><span id="InfiniteDetector-307"><a href="#InfiniteDetector-307"><span class="linenos">307</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">=</span> <span class="n">CentralPoint</span> <span class="o">+</span> <span class="n">CentralRay</span><span class="o">.</span><span class="n">vector</span> <span class="o">*</span> <span class="n">DistanceDetector</span>
</span><span id="InfiniteDetector-308"><a href="#InfiniteDetector-308"><span class="linenos">308</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refpoint</span> <span class="o">=</span> <span class="n">CentralPoint</span>
</span><span id="InfiniteDetector-309"><a href="#InfiniteDetector-309"><span class="linenos">309</span></a>
</span><span id="InfiniteDetector-310"><a href="#InfiniteDetector-310"><span class="linenos">310</span></a>    <span class="k">def</span> <span class="nf">get_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="InfiniteDetector-311"><a href="#InfiniteDetector-311"><span class="linenos">311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-312"><a href="#InfiniteDetector-312"><span class="linenos">312</span></a><span class="sd">        Return distance of the Detector-plane from its reference point Detector.refpoint.</span>
</span><span id="InfiniteDetector-313"><a href="#InfiniteDetector-313"><span class="linenos">313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-314"><a href="#InfiniteDetector-314"><span class="linenos">314</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
</span><span id="InfiniteDetector-315"><a href="#InfiniteDetector-315"><span class="linenos">315</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refpoint</span> <span class="o">-</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">IntersectionLinePlane</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refpoint</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">normal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span><span class="p">)</span>
</span><span id="InfiniteDetector-316"><a href="#InfiniteDetector-316"><span class="linenos">316</span></a>        <span class="p">)</span>
</span><span id="InfiniteDetector-317"><a href="#InfiniteDetector-317"><span class="linenos">317</span></a>
</span><span id="InfiniteDetector-318"><a href="#InfiniteDetector-318"><span class="linenos">318</span></a>    <span class="k">def</span> <span class="nf">shiftToDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NewDistance</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="InfiniteDetector-319"><a href="#InfiniteDetector-319"><span class="linenos">319</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-320"><a href="#InfiniteDetector-320"><span class="linenos">320</span></a><span class="sd">        Shift the Detector to the distance NewDistance from its reference point Detector.refpoint.</span>
</span><span id="InfiniteDetector-321"><a href="#InfiniteDetector-321"><span class="linenos">321</span></a>
</span><span id="InfiniteDetector-322"><a href="#InfiniteDetector-322"><span class="linenos">322</span></a><span class="sd">        Parameters</span>
</span><span id="InfiniteDetector-323"><a href="#InfiniteDetector-323"><span class="linenos">323</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector-324"><a href="#InfiniteDetector-324"><span class="linenos">324</span></a><span class="sd">            NewDistance : float</span>
</span><span id="InfiniteDetector-325"><a href="#InfiniteDetector-325"><span class="linenos">325</span></a><span class="sd">                The distance (absolute) to which to shift the Detector.</span>
</span><span id="InfiniteDetector-326"><a href="#InfiniteDetector-326"><span class="linenos">326</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-327"><a href="#InfiniteDetector-327"><span class="linenos">327</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="InfiniteDetector-328"><a href="#InfiniteDetector-328"><span class="linenos">328</span></a>            <span class="n">shiftby</span> <span class="o">=</span> <span class="n">NewDistance</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distance</span><span class="p">()</span>  <span class="c1"># by that much in the self.normal-direction</span>
</span><span id="InfiniteDetector-329"><a href="#InfiniteDetector-329"><span class="linenos">329</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector-330"><a href="#InfiniteDetector-330"><span class="linenos">330</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The new Detector Distance must be int or float.&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector-331"><a href="#InfiniteDetector-331"><span class="linenos">331</span></a>
</span><span id="InfiniteDetector-332"><a href="#InfiniteDetector-332"><span class="linenos">332</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">+=</span> <span class="o">-</span><span class="n">shiftby</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span>
</span><span id="InfiniteDetector-333"><a href="#InfiniteDetector-333"><span class="linenos">333</span></a>
</span><span id="InfiniteDetector-334"><a href="#InfiniteDetector-334"><span class="linenos">334</span></a>    <span class="k">def</span> <span class="nf">shiftByDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Shift</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="InfiniteDetector-335"><a href="#InfiniteDetector-335"><span class="linenos">335</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-336"><a href="#InfiniteDetector-336"><span class="linenos">336</span></a><span class="sd">        Shift the Detector *by* the distance Shift along its normal vector Detector.normal.</span>
</span><span id="InfiniteDetector-337"><a href="#InfiniteDetector-337"><span class="linenos">337</span></a>
</span><span id="InfiniteDetector-338"><a href="#InfiniteDetector-338"><span class="linenos">338</span></a><span class="sd">        Parameters</span>
</span><span id="InfiniteDetector-339"><a href="#InfiniteDetector-339"><span class="linenos">339</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector-340"><a href="#InfiniteDetector-340"><span class="linenos">340</span></a><span class="sd">            Shift : float</span>
</span><span id="InfiniteDetector-341"><a href="#InfiniteDetector-341"><span class="linenos">341</span></a><span class="sd">                The distance (relative) *by* which to shift the Detector.</span>
</span><span id="InfiniteDetector-342"><a href="#InfiniteDetector-342"><span class="linenos">342</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-343"><a href="#InfiniteDetector-343"><span class="linenos">343</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="InfiniteDetector-344"><a href="#InfiniteDetector-344"><span class="linenos">344</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">-</span> <span class="n">Shift</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span>  <span class="c1"># directly set _centre, i.e. circumvent setter</span>
</span><span id="InfiniteDetector-345"><a href="#InfiniteDetector-345"><span class="linenos">345</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector-346"><a href="#InfiniteDetector-346"><span class="linenos">346</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The Detector Distance Shift must be int or float.&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector-347"><a href="#InfiniteDetector-347"><span class="linenos">347</span></a>
</span><span id="InfiniteDetector-348"><a href="#InfiniteDetector-348"><span class="linenos">348</span></a>    <span class="k">def</span> <span class="nf">_iscomplete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="InfiniteDetector-349"><a href="#InfiniteDetector-349"><span class="linenos">349</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-350"><a href="#InfiniteDetector-350"><span class="linenos">350</span></a><span class="sd">        Checks whether the Detector plane is defined by a centre-point and normal-vector.</span>
</span><span id="InfiniteDetector-351"><a href="#InfiniteDetector-351"><span class="linenos">351</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-352"><a href="#InfiniteDetector-352"><span class="linenos">352</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="InfiniteDetector-353"><a href="#InfiniteDetector-353"><span class="linenos">353</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The detector has no centre or orientation defined yet.&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector-354"><a href="#InfiniteDetector-354"><span class="linenos">354</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector-355"><a href="#InfiniteDetector-355"><span class="linenos">355</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="InfiniteDetector-356"><a href="#InfiniteDetector-356"><span class="linenos">356</span></a>
</span><span id="InfiniteDetector-357"><a href="#InfiniteDetector-357"><span class="linenos">357</span></a>    <span class="c1"># %% METHODS TO GET THE DETECTOR REPONSE ##################################################################</span>
</span><span id="InfiniteDetector-358"><a href="#InfiniteDetector-358"><span class="linenos">358</span></a>
</span><span id="InfiniteDetector-359"><a href="#InfiniteDetector-359"><span class="linenos">359</span></a>    <span class="k">def</span> <span class="nf">get_PointList3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="InfiniteDetector-360"><a href="#InfiniteDetector-360"><span class="linenos">360</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-361"><a href="#InfiniteDetector-361"><span class="linenos">361</span></a><span class="sd">        Returns the list of 3D-points in lab-space where the rays in the</span>
</span><span id="InfiniteDetector-362"><a href="#InfiniteDetector-362"><span class="linenos">362</span></a><span class="sd">        list RayList hit the detector plane.</span>
</span><span id="InfiniteDetector-363"><a href="#InfiniteDetector-363"><span class="linenos">363</span></a>
</span><span id="InfiniteDetector-364"><a href="#InfiniteDetector-364"><span class="linenos">364</span></a><span class="sd">        Parameters</span>
</span><span id="InfiniteDetector-365"><a href="#InfiniteDetector-365"><span class="linenos">365</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector-366"><a href="#InfiniteDetector-366"><span class="linenos">366</span></a><span class="sd">            RayList : list[Ray]</span>
</span><span id="InfiniteDetector-367"><a href="#InfiniteDetector-367"><span class="linenos">367</span></a><span class="sd">                A list of objects of the ModuleOpticalRay.Ray-class.</span>
</span><span id="InfiniteDetector-368"><a href="#InfiniteDetector-368"><span class="linenos">368</span></a>
</span><span id="InfiniteDetector-369"><a href="#InfiniteDetector-369"><span class="linenos">369</span></a><span class="sd">        Returns</span>
</span><span id="InfiniteDetector-370"><a href="#InfiniteDetector-370"><span class="linenos">370</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector-371"><a href="#InfiniteDetector-371"><span class="linenos">371</span></a><span class="sd">            ListPointDetector3D : list[np.ndarray of shape (3,)]</span>
</span><span id="InfiniteDetector-372"><a href="#InfiniteDetector-372"><span class="linenos">372</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-373"><a href="#InfiniteDetector-373"><span class="linenos">373</span></a>        <span class="n">XY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_PointList2D</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="InfiniteDetector-374"><a href="#InfiniteDetector-374"><span class="linenos">374</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">XY</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],))</span>
</span><span id="InfiniteDetector-375"><a href="#InfiniteDetector-375"><span class="linenos">375</span></a>        <span class="n">XYZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">XY</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span><span class="n">Z</span><span class="p">]))</span>
</span><span id="InfiniteDetector-376"><a href="#InfiniteDetector-376"><span class="linenos">376</span></a>        <span class="n">XYZ</span> <span class="o">=</span> <span class="n">quaternion</span><span class="o">.</span><span class="n">rotate_vectors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="n">XYZ</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span>
</span><span id="InfiniteDetector-377"><a href="#InfiniteDetector-377"><span class="linenos">377</span></a>        <span class="k">return</span> <span class="n">XYZ</span>
</span><span id="InfiniteDetector-378"><a href="#InfiniteDetector-378"><span class="linenos">378</span></a>
</span><span id="InfiniteDetector-379"><a href="#InfiniteDetector-379"><span class="linenos">379</span></a>    <span class="k">def</span> <span class="nf">get_PointList2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="InfiniteDetector-380"><a href="#InfiniteDetector-380"><span class="linenos">380</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-381"><a href="#InfiniteDetector-381"><span class="linenos">381</span></a><span class="sd">        Returns the list of 2D-points in the detector plane, with the origin at Detector.centre.</span>
</span><span id="InfiniteDetector-382"><a href="#InfiniteDetector-382"><span class="linenos">382</span></a>
</span><span id="InfiniteDetector-383"><a href="#InfiniteDetector-383"><span class="linenos">383</span></a><span class="sd">        Parameters</span>
</span><span id="InfiniteDetector-384"><a href="#InfiniteDetector-384"><span class="linenos">384</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector-385"><a href="#InfiniteDetector-385"><span class="linenos">385</span></a><span class="sd">            RayList : list[Ray]</span>
</span><span id="InfiniteDetector-386"><a href="#InfiniteDetector-386"><span class="linenos">386</span></a><span class="sd">                A list of objects of the ModuleOpticalRay.Ray-class of length N</span>
</span><span id="InfiniteDetector-387"><a href="#InfiniteDetector-387"><span class="linenos">387</span></a>
</span><span id="InfiniteDetector-388"><a href="#InfiniteDetector-388"><span class="linenos">388</span></a><span class="sd">        Returns</span>
</span><span id="InfiniteDetector-389"><a href="#InfiniteDetector-389"><span class="linenos">389</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector-390"><a href="#InfiniteDetector-390"><span class="linenos">390</span></a><span class="sd">            XY : np.ndarray of shape (N,2)</span>
</span><span id="InfiniteDetector-391"><a href="#InfiniteDetector-391"><span class="linenos">391</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-392"><a href="#InfiniteDetector-392"><span class="linenos">392</span></a>        <span class="n">RayList</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">TranslationRayList</span><span class="p">(</span><span class="n">RayList</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">)</span>
</span><span id="InfiniteDetector-393"><a href="#InfiniteDetector-393"><span class="linenos">393</span></a>        <span class="n">RayList</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">RotationRayListByQ</span><span class="p">(</span><span class="n">RayList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span>
</span><span id="InfiniteDetector-394"><a href="#InfiniteDetector-394"><span class="linenos">394</span></a>        <span class="n">X</span><span class="p">,</span><span class="n">Y</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">IntersectionRayListZPlane</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="InfiniteDetector-395"><a href="#InfiniteDetector-395"><span class="linenos">395</span></a>        <span class="n">XY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">]))</span>
</span><span id="InfiniteDetector-396"><a href="#InfiniteDetector-396"><span class="linenos">396</span></a>        <span class="k">return</span> <span class="n">XY</span>
</span><span id="InfiniteDetector-397"><a href="#InfiniteDetector-397"><span class="linenos">397</span></a>
</span><span id="InfiniteDetector-398"><a href="#InfiniteDetector-398"><span class="linenos">398</span></a>    <span class="k">def</span> <span class="nf">get_PointList2DCentre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="InfiniteDetector-399"><a href="#InfiniteDetector-399"><span class="linenos">399</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-400"><a href="#InfiniteDetector-400"><span class="linenos">400</span></a><span class="sd">        Returns the list of 2D-points in the detector plane, with the origin centered in the point cloud.</span>
</span><span id="InfiniteDetector-401"><a href="#InfiniteDetector-401"><span class="linenos">401</span></a>
</span><span id="InfiniteDetector-402"><a href="#InfiniteDetector-402"><span class="linenos">402</span></a><span class="sd">        Parameters</span>
</span><span id="InfiniteDetector-403"><a href="#InfiniteDetector-403"><span class="linenos">403</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector-404"><a href="#InfiniteDetector-404"><span class="linenos">404</span></a><span class="sd">            RayList* : list[Ray]</span>
</span><span id="InfiniteDetector-405"><a href="#InfiniteDetector-405"><span class="linenos">405</span></a><span class="sd">                A list of objects of the ModuleOpticalRay.Ray-class.</span>
</span><span id="InfiniteDetector-406"><a href="#InfiniteDetector-406"><span class="linenos">406</span></a>
</span><span id="InfiniteDetector-407"><a href="#InfiniteDetector-407"><span class="linenos">407</span></a><span class="sd">        Returns</span>
</span><span id="InfiniteDetector-408"><a href="#InfiniteDetector-408"><span class="linenos">408</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector-409"><a href="#InfiniteDetector-409"><span class="linenos">409</span></a><span class="sd">            ListPointDetector2DCentre : list[np.ndarray of shape (2,)]</span>
</span><span id="InfiniteDetector-410"><a href="#InfiniteDetector-410"><span class="linenos">410</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-411"><a href="#InfiniteDetector-411"><span class="linenos">411</span></a>        <span class="n">ArrayPointDetector2D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_PointList2D</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="InfiniteDetector-412"><a href="#InfiniteDetector-412"><span class="linenos">412</span></a>        <span class="n">ArrayPointDetector2D</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ArrayPointDetector2D</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="InfiniteDetector-413"><a href="#InfiniteDetector-413"><span class="linenos">413</span></a>        <span class="k">return</span> <span class="n">ArrayPointDetector2D</span>
</span><span id="InfiniteDetector-414"><a href="#InfiniteDetector-414"><span class="linenos">414</span></a>
</span><span id="InfiniteDetector-415"><a href="#InfiniteDetector-415"><span class="linenos">415</span></a>    <span class="k">def</span> <span class="nf">get_Delays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="InfiniteDetector-416"><a href="#InfiniteDetector-416"><span class="linenos">416</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-417"><a href="#InfiniteDetector-417"><span class="linenos">417</span></a><span class="sd">        Returns the list of delays of the rays of RayList as they hit the detector plane,</span>
</span><span id="InfiniteDetector-418"><a href="#InfiniteDetector-418"><span class="linenos">418</span></a><span class="sd">        calculated as their total path length divided by the speed of light.</span>
</span><span id="InfiniteDetector-419"><a href="#InfiniteDetector-419"><span class="linenos">419</span></a><span class="sd">        The delays are relative to the mean “travel time”, i.e. the mean path length of RayList</span>
</span><span id="InfiniteDetector-420"><a href="#InfiniteDetector-420"><span class="linenos">420</span></a><span class="sd">        divided by the speed of light.</span>
</span><span id="InfiniteDetector-421"><a href="#InfiniteDetector-421"><span class="linenos">421</span></a><span class="sd">        The list index corresponds to that of the RayList.</span>
</span><span id="InfiniteDetector-422"><a href="#InfiniteDetector-422"><span class="linenos">422</span></a>
</span><span id="InfiniteDetector-423"><a href="#InfiniteDetector-423"><span class="linenos">423</span></a><span class="sd">        Parameters</span>
</span><span id="InfiniteDetector-424"><a href="#InfiniteDetector-424"><span class="linenos">424</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector-425"><a href="#InfiniteDetector-425"><span class="linenos">425</span></a><span class="sd">            RayList : list[Ray]</span>
</span><span id="InfiniteDetector-426"><a href="#InfiniteDetector-426"><span class="linenos">426</span></a><span class="sd">                A list of objects of the ModuleOpticalRay.Ray-class.</span>
</span><span id="InfiniteDetector-427"><a href="#InfiniteDetector-427"><span class="linenos">427</span></a>
</span><span id="InfiniteDetector-428"><a href="#InfiniteDetector-428"><span class="linenos">428</span></a><span class="sd">        Returns</span>
</span><span id="InfiniteDetector-429"><a href="#InfiniteDetector-429"><span class="linenos">429</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector-430"><a href="#InfiniteDetector-430"><span class="linenos">430</span></a><span class="sd">            DelayList : list[float]</span>
</span><span id="InfiniteDetector-431"><a href="#InfiniteDetector-431"><span class="linenos">431</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector-432"><a href="#InfiniteDetector-432"><span class="linenos">432</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iscomplete</span><span class="p">():</span>
</span><span id="InfiniteDetector-433"><a href="#InfiniteDetector-433"><span class="linenos">433</span></a>            <span class="n">DetectorPointList3D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_PointList3D</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="InfiniteDetector-434"><a href="#InfiniteDetector-434"><span class="linenos">434</span></a>            <span class="n">OpticalPathList</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="InfiniteDetector-435"><a href="#InfiniteDetector-435"><span class="linenos">435</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">RayList</span><span class="p">)):</span>
</span><span id="InfiniteDetector-436"><a href="#InfiniteDetector-436"><span class="linenos">436</span></a>                <span class="n">OpticalPathList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">RayList</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">point</span> <span class="o">-</span> <span class="n">DetectorPointList3D</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RayList</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
</span><span id="InfiniteDetector-437"><a href="#InfiniteDetector-437"><span class="linenos">437</span></a>
</span><span id="InfiniteDetector-438"><a href="#InfiniteDetector-438"><span class="linenos">438</span></a>            <span class="n">MeanPath</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">OpticalPathList</span><span class="p">)</span>
</span><span id="InfiniteDetector-439"><a href="#InfiniteDetector-439"><span class="linenos">439</span></a>            <span class="n">DelayList</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span> <span class="o">-</span> <span class="n">MeanPath</span><span class="p">)</span> <span class="o">/</span> <span class="n">LightSpeed</span> <span class="o">*</span> <span class="mf">1e15</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">OpticalPathList</span><span class="p">]</span>  <span class="c1"># in fs, c in mm/s</span>
</span><span id="InfiniteDetector-440"><a href="#InfiniteDetector-440"><span class="linenos">440</span></a>            <span class="k">return</span> <span class="n">DelayList</span>
</span></pre></div>


            <div class="docstring"><p>A detector is simply a plane in 3D-lab-space.
It is defined by a point <a href="#Detector.centre">Detector.centre</a> and its
orientation Detector.orientation (a quaternion rotating it from the initial alignment)
These are optional arguments when creating a Detector-instance, because they can
later be set automatically by the method Detector.autoplace().
The Detector has a reference point "RefPoint", with respect to which a distance
can be returned via the method Detector.get distance.</p>

<h2 id="attributes">Attributes</h2>

<pre><code>centre : np.ndarray
    3D Point in the Detector plane.

normal : np.ndarray
   3D Normal vector on the Detector plane.

refpoint : np.ndarray
    3D reference point from which to measure the Detector distance.
</code></pre>
</div>


                            <div id="InfiniteDetector.__init__" class="classattr">
                                        <input id="InfiniteDetector.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@singledispatchmethod</div>

        <span class="name">InfiniteDetector</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">Orientation</span><span class="p">:</span> <span class="n">quaternion</span><span class="o">.</span><span class="n">quaternion</span>,</span><span class="param">	<span class="n">Centre</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">RefPoint</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="InfiniteDetector.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfiniteDetector.__init__"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="InfiniteDetector.__init__-172"><a href="#InfiniteDetector.__init__-172"><span class="linenos">172</span></a>    <span class="nd">@singledispatchmethod</span>
</span><span id="InfiniteDetector.__init__-173"><a href="#InfiniteDetector.__init__-173"><span class="linenos">173</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Orientation</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">quaternion</span><span class="p">,</span> <span class="n">Centre</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">RefPoint</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="InfiniteDetector.__init__-174"><a href="#InfiniteDetector.__init__-174"><span class="linenos">174</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.__init__-175"><a href="#InfiniteDetector.__init__-175"><span class="linenos">175</span></a><span class="sd">        Parameters</span>
</span><span id="InfiniteDetector.__init__-176"><a href="#InfiniteDetector.__init__-176"><span class="linenos">176</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector.__init__-177"><a href="#InfiniteDetector.__init__-177"><span class="linenos">177</span></a><span class="sd">            Orientation : np.quaternion</span>
</span><span id="InfiniteDetector.__init__-178"><a href="#InfiniteDetector.__init__-178"><span class="linenos">178</span></a><span class="sd">               Quaternion describing rotation from initial orientation (x-axis along x axis, normal towards positive z).</span>
</span><span id="InfiniteDetector.__init__-179"><a href="#InfiniteDetector.__init__-179"><span class="linenos">179</span></a>
</span><span id="InfiniteDetector.__init__-180"><a href="#InfiniteDetector.__init__-180"><span class="linenos">180</span></a><span class="sd">            Centre : np.ndarray</span>
</span><span id="InfiniteDetector.__init__-181"><a href="#InfiniteDetector.__init__-181"><span class="linenos">181</span></a><span class="sd">               3D Point in the Detector plane.</span>
</span><span id="InfiniteDetector.__init__-182"><a href="#InfiniteDetector.__init__-182"><span class="linenos">182</span></a>
</span><span id="InfiniteDetector.__init__-183"><a href="#InfiniteDetector.__init__-183"><span class="linenos">183</span></a><span class="sd">            RefPoint : np.ndarray, optional</span>
</span><span id="InfiniteDetector.__init__-184"><a href="#InfiniteDetector.__init__-184"><span class="linenos">184</span></a><span class="sd">                3D Reference point from which to measure the Detector distance.</span>
</span><span id="InfiniteDetector.__init__-185"><a href="#InfiniteDetector.__init__-185"><span class="linenos">185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.__init__-186"><a href="#InfiniteDetector.__init__-186"><span class="linenos">186</span></a>        <span class="n">Centre</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">Centre</span><span class="p">)</span>
</span><span id="InfiniteDetector.__init__-187"><a href="#InfiniteDetector.__init__-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">=</span> <span class="n">Centre</span>
</span><span id="InfiniteDetector.__init__-188"><a href="#InfiniteDetector.__init__-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">Orientation</span>
</span><span id="InfiniteDetector.__init__-189"><a href="#InfiniteDetector.__init__-189"><span class="linenos">189</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">RefPoint</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">RefPoint</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
</span><span id="InfiniteDetector.__init__-190"><a href="#InfiniteDetector.__init__-190"><span class="linenos">190</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">RefPoint</span><span class="p">)</span>
</span><span id="InfiniteDetector.__init__-191"><a href="#InfiniteDetector.__init__-191"><span class="linenos">191</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector.__init__-192"><a href="#InfiniteDetector.__init__-192"><span class="linenos">192</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span> <span class="o">=</span> <span class="n">Centre</span>
</span></pre></div>


            <div class="docstring"><h2 id="parameters">Parameters</h2>

<pre><code>Orientation : np.quaternion
   Quaternion describing rotation from initial orientation (x-axis along x axis, normal towards positive z).

Centre : np.ndarray
   3D Point in the Detector plane.

RefPoint : np.ndarray, optional
    3D Reference point from which to measure the Detector distance.
</code></pre>
</div>


                            </div>
                            <div id="InfiniteDetector.centre" class="classattr">
                                        <input id="InfiniteDetector.centre-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">centre</span>

                <label class="view-source-button" for="InfiniteDetector.centre-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfiniteDetector.centre"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="InfiniteDetector.centre-234"><a href="#InfiniteDetector.centre-234"><span class="linenos">234</span></a>    <span class="nd">@property</span>
</span><span id="InfiniteDetector.centre-235"><a href="#InfiniteDetector.centre-235"><span class="linenos">235</span></a>    <span class="k">def</span> <span class="nf">centre</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="InfiniteDetector.centre-236"><a href="#InfiniteDetector.centre-236"><span class="linenos">236</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span>
</span></pre></div>


    

                            </div>
                            <div id="InfiniteDetector.orientation" class="classattr">
                                        <input id="InfiniteDetector.orientation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">orientation</span>

                <label class="view-source-button" for="InfiniteDetector.orientation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfiniteDetector.orientation"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="InfiniteDetector.orientation-246"><a href="#InfiniteDetector.orientation-246"><span class="linenos">246</span></a>    <span class="nd">@property</span>
</span><span id="InfiniteDetector.orientation-247"><a href="#InfiniteDetector.orientation-247"><span class="linenos">247</span></a>    <span class="k">def</span> <span class="nf">orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="InfiniteDetector.orientation-248"><a href="#InfiniteDetector.orientation-248"><span class="linenos">248</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span>
</span></pre></div>


    

                            </div>
                            <div id="InfiniteDetector.normal" class="classattr">
                                        <input id="InfiniteDetector.normal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">normal</span>

                <label class="view-source-button" for="InfiniteDetector.normal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfiniteDetector.normal"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="InfiniteDetector.normal-257"><a href="#InfiniteDetector.normal-257"><span class="linenos">257</span></a>    <span class="nd">@property</span>
</span><span id="InfiniteDetector.normal-258"><a href="#InfiniteDetector.normal-258"><span class="linenos">258</span></a>    <span class="k">def</span> <span class="nf">normal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="InfiniteDetector.normal-259"><a href="#InfiniteDetector.normal-259"><span class="linenos">259</span></a>        <span class="n">internal_normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
</span><span id="InfiniteDetector.normal-260"><a href="#InfiniteDetector.normal-260"><span class="linenos">260</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">quaternion</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">internal_normal</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span><span class="o">.</span><span class="n">imag</span>
</span></pre></div>


    

                            </div>
                            <div id="InfiniteDetector.refpoint" class="classattr">
                                        <input id="InfiniteDetector.refpoint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">refpoint</span>

                <label class="view-source-button" for="InfiniteDetector.refpoint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfiniteDetector.refpoint"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="InfiniteDetector.refpoint-262"><a href="#InfiniteDetector.refpoint-262"><span class="linenos">262</span></a>    <span class="nd">@property</span>
</span><span id="InfiniteDetector.refpoint-263"><a href="#InfiniteDetector.refpoint-263"><span class="linenos">263</span></a>    <span class="k">def</span> <span class="nf">refpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="InfiniteDetector.refpoint-264"><a href="#InfiniteDetector.refpoint-264"><span class="linenos">264</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refpoint</span>
</span></pre></div>


    

                            </div>
                            <div id="InfiniteDetector.copy_detector" class="classattr">
                                        <input id="InfiniteDetector.copy_detector-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">copy_detector</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InfiniteDetector.copy_detector-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfiniteDetector.copy_detector"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="InfiniteDetector.copy_detector-276"><a href="#InfiniteDetector.copy_detector-276"><span class="linenos">276</span></a>    <span class="k">def</span> <span class="nf">copy_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="InfiniteDetector.copy_detector-277"><a href="#InfiniteDetector.copy_detector-277"><span class="linenos">277</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.copy_detector-278"><a href="#InfiniteDetector.copy_detector-278"><span class="linenos">278</span></a><span class="sd">        Returns a new Detector object with the same properties.</span>
</span><span id="InfiniteDetector.copy_detector-279"><a href="#InfiniteDetector.copy_detector-279"><span class="linenos">279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.copy_detector-280"><a href="#InfiniteDetector.copy_detector-280"><span class="linenos">280</span></a>        <span class="k">return</span> <span class="n">Detector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refpoint</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns a new Detector object with the same properties.</p>
</div>


                            </div>
                            <div id="InfiniteDetector.autoplace" class="classattr">
                                        <input id="InfiniteDetector.autoplace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">autoplace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">RayList</span>, </span><span class="param"><span class="n">DistanceDetector</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InfiniteDetector.autoplace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfiniteDetector.autoplace"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="InfiniteDetector.autoplace-282"><a href="#InfiniteDetector.autoplace-282"><span class="linenos">282</span></a>    <span class="k">def</span> <span class="nf">autoplace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">,</span> <span class="n">DistanceDetector</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="InfiniteDetector.autoplace-283"><a href="#InfiniteDetector.autoplace-283"><span class="linenos">283</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.autoplace-284"><a href="#InfiniteDetector.autoplace-284"><span class="linenos">284</span></a><span class="sd">        Automatically place and orient the detector such that it is normal to the central ray</span>
</span><span id="InfiniteDetector.autoplace-285"><a href="#InfiniteDetector.autoplace-285"><span class="linenos">285</span></a><span class="sd">        of the supplied RayList, at the distance DistanceDetector the origin point of that central ray.</span>
</span><span id="InfiniteDetector.autoplace-286"><a href="#InfiniteDetector.autoplace-286"><span class="linenos">286</span></a>
</span><span id="InfiniteDetector.autoplace-287"><a href="#InfiniteDetector.autoplace-287"><span class="linenos">287</span></a><span class="sd">        Parameters</span>
</span><span id="InfiniteDetector.autoplace-288"><a href="#InfiniteDetector.autoplace-288"><span class="linenos">288</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector.autoplace-289"><a href="#InfiniteDetector.autoplace-289"><span class="linenos">289</span></a><span class="sd">            RayList : list[Ray]</span>
</span><span id="InfiniteDetector.autoplace-290"><a href="#InfiniteDetector.autoplace-290"><span class="linenos">290</span></a><span class="sd">                A list of objects of the ModuleOpticalRay.Ray-class.</span>
</span><span id="InfiniteDetector.autoplace-291"><a href="#InfiniteDetector.autoplace-291"><span class="linenos">291</span></a>
</span><span id="InfiniteDetector.autoplace-292"><a href="#InfiniteDetector.autoplace-292"><span class="linenos">292</span></a><span class="sd">            DistanceDetector : float</span>
</span><span id="InfiniteDetector.autoplace-293"><a href="#InfiniteDetector.autoplace-293"><span class="linenos">293</span></a><span class="sd">                The distance at which to place the Detector.</span>
</span><span id="InfiniteDetector.autoplace-294"><a href="#InfiniteDetector.autoplace-294"><span class="linenos">294</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.autoplace-295"><a href="#InfiniteDetector.autoplace-295"><span class="linenos">295</span></a>        <span class="n">CentralRay</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">FindCentralRay</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="InfiniteDetector.autoplace-296"><a href="#InfiniteDetector.autoplace-296"><span class="linenos">296</span></a>        <span class="n">CentralRay</span> <span class="o">=</span> <span class="n">RayList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="InfiniteDetector.autoplace-297"><a href="#InfiniteDetector.autoplace-297"><span class="linenos">297</span></a>        <span class="k">if</span> <span class="n">CentralRay</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="InfiniteDetector.autoplace-298"><a href="#InfiniteDetector.autoplace-298"><span class="linenos">298</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find central ray! The list of rays has a length of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector.autoplace-299"><a href="#InfiniteDetector.autoplace-299"><span class="linenos">299</span></a>            <span class="n">CentralPoint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="InfiniteDetector.autoplace-300"><a href="#InfiniteDetector.autoplace-300"><span class="linenos">300</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">RayList</span><span class="p">:</span>
</span><span id="InfiniteDetector.autoplace-301"><a href="#InfiniteDetector.autoplace-301"><span class="linenos">301</span></a>                <span class="n">CentralPoint</span> <span class="o">=</span> <span class="n">CentralPoint</span> <span class="o">+</span> <span class="n">k</span><span class="o">.</span><span class="n">point</span>
</span><span id="InfiniteDetector.autoplace-302"><a href="#InfiniteDetector.autoplace-302"><span class="linenos">302</span></a>            <span class="n">CentralPoint</span> <span class="o">=</span> <span class="n">CentralPoint</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="InfiniteDetector.autoplace-303"><a href="#InfiniteDetector.autoplace-303"><span class="linenos">303</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector.autoplace-304"><a href="#InfiniteDetector.autoplace-304"><span class="linenos">304</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found central ray, using it to position detector: </span><span class="se">\n</span><span class="si">{</span><span class="n">CentralRay</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector.autoplace-305"><a href="#InfiniteDetector.autoplace-305"><span class="linenos">305</span></a>            <span class="n">CentralPoint</span> <span class="o">=</span> <span class="n">CentralRay</span><span class="o">.</span><span class="n">point</span>
</span><span id="InfiniteDetector.autoplace-306"><a href="#InfiniteDetector.autoplace-306"><span class="linenos">306</span></a>
</span><span id="InfiniteDetector.autoplace-307"><a href="#InfiniteDetector.autoplace-307"><span class="linenos">307</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">=</span> <span class="n">CentralPoint</span> <span class="o">+</span> <span class="n">CentralRay</span><span class="o">.</span><span class="n">vector</span> <span class="o">*</span> <span class="n">DistanceDetector</span>
</span><span id="InfiniteDetector.autoplace-308"><a href="#InfiniteDetector.autoplace-308"><span class="linenos">308</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refpoint</span> <span class="o">=</span> <span class="n">CentralPoint</span>
</span></pre></div>


            <div class="docstring"><p>Automatically place and orient the detector such that it is normal to the central ray
of the supplied RayList, at the distance DistanceDetector the origin point of that central ray.</p>

<h2 id="parameters">Parameters</h2>

<pre><code>RayList : list[Ray]
    A list of objects of the ModuleOpticalRay.Ray-class.

DistanceDetector : float
    The distance at which to place the Detector.
</code></pre>
</div>


                            </div>
                            <div id="InfiniteDetector.get_distance" class="classattr">
                                        <input id="InfiniteDetector.get_distance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_distance</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InfiniteDetector.get_distance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfiniteDetector.get_distance"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="InfiniteDetector.get_distance-310"><a href="#InfiniteDetector.get_distance-310"><span class="linenos">310</span></a>    <span class="k">def</span> <span class="nf">get_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="InfiniteDetector.get_distance-311"><a href="#InfiniteDetector.get_distance-311"><span class="linenos">311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.get_distance-312"><a href="#InfiniteDetector.get_distance-312"><span class="linenos">312</span></a><span class="sd">        Return distance of the Detector-plane from its reference point Detector.refpoint.</span>
</span><span id="InfiniteDetector.get_distance-313"><a href="#InfiniteDetector.get_distance-313"><span class="linenos">313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.get_distance-314"><a href="#InfiniteDetector.get_distance-314"><span class="linenos">314</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
</span><span id="InfiniteDetector.get_distance-315"><a href="#InfiniteDetector.get_distance-315"><span class="linenos">315</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refpoint</span> <span class="o">-</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">IntersectionLinePlane</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refpoint</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">normal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span><span class="p">)</span>
</span><span id="InfiniteDetector.get_distance-316"><a href="#InfiniteDetector.get_distance-316"><span class="linenos">316</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return distance of the Detector-plane from its reference point <a href="#Detector.refpoint">Detector.refpoint</a>.</p>
</div>


                            </div>
                            <div id="InfiniteDetector.shiftToDistance" class="classattr">
                                        <input id="InfiniteDetector.shiftToDistance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">shiftToDistance</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">NewDistance</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InfiniteDetector.shiftToDistance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfiniteDetector.shiftToDistance"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="InfiniteDetector.shiftToDistance-318"><a href="#InfiniteDetector.shiftToDistance-318"><span class="linenos">318</span></a>    <span class="k">def</span> <span class="nf">shiftToDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NewDistance</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="InfiniteDetector.shiftToDistance-319"><a href="#InfiniteDetector.shiftToDistance-319"><span class="linenos">319</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.shiftToDistance-320"><a href="#InfiniteDetector.shiftToDistance-320"><span class="linenos">320</span></a><span class="sd">        Shift the Detector to the distance NewDistance from its reference point Detector.refpoint.</span>
</span><span id="InfiniteDetector.shiftToDistance-321"><a href="#InfiniteDetector.shiftToDistance-321"><span class="linenos">321</span></a>
</span><span id="InfiniteDetector.shiftToDistance-322"><a href="#InfiniteDetector.shiftToDistance-322"><span class="linenos">322</span></a><span class="sd">        Parameters</span>
</span><span id="InfiniteDetector.shiftToDistance-323"><a href="#InfiniteDetector.shiftToDistance-323"><span class="linenos">323</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector.shiftToDistance-324"><a href="#InfiniteDetector.shiftToDistance-324"><span class="linenos">324</span></a><span class="sd">            NewDistance : float</span>
</span><span id="InfiniteDetector.shiftToDistance-325"><a href="#InfiniteDetector.shiftToDistance-325"><span class="linenos">325</span></a><span class="sd">                The distance (absolute) to which to shift the Detector.</span>
</span><span id="InfiniteDetector.shiftToDistance-326"><a href="#InfiniteDetector.shiftToDistance-326"><span class="linenos">326</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.shiftToDistance-327"><a href="#InfiniteDetector.shiftToDistance-327"><span class="linenos">327</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">NewDistance</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="InfiniteDetector.shiftToDistance-328"><a href="#InfiniteDetector.shiftToDistance-328"><span class="linenos">328</span></a>            <span class="n">shiftby</span> <span class="o">=</span> <span class="n">NewDistance</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distance</span><span class="p">()</span>  <span class="c1"># by that much in the self.normal-direction</span>
</span><span id="InfiniteDetector.shiftToDistance-329"><a href="#InfiniteDetector.shiftToDistance-329"><span class="linenos">329</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector.shiftToDistance-330"><a href="#InfiniteDetector.shiftToDistance-330"><span class="linenos">330</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The new Detector Distance must be int or float.&quot;</span><span class="p">)</span>
</span><span id="InfiniteDetector.shiftToDistance-331"><a href="#InfiniteDetector.shiftToDistance-331"><span class="linenos">331</span></a>
</span><span id="InfiniteDetector.shiftToDistance-332"><a href="#InfiniteDetector.shiftToDistance-332"><span class="linenos">332</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">+=</span> <span class="o">-</span><span class="n">shiftby</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span>
</span></pre></div>


            <div class="docstring"><p>Shift the Detector to the distance NewDistance from its reference point <a href="#Detector.refpoint">Detector.refpoint</a>.</p>

<h2 id="parameters">Parameters</h2>

<pre><code>NewDistance : float
    The distance (absolute) to which to shift the Detector.
</code></pre>
</div>


                            </div>
                            <div id="InfiniteDetector.shiftByDistance" class="classattr">
                                        <input id="InfiniteDetector.shiftByDistance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">shiftByDistance</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">Shift</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InfiniteDetector.shiftByDistance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfiniteDetector.shiftByDistance"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="InfiniteDetector.shiftByDistance-334"><a href="#InfiniteDetector.shiftByDistance-334"><span class="linenos">334</span></a>    <span class="k">def</span> <span class="nf">shiftByDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Shift</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="InfiniteDetector.shiftByDistance-335"><a href="#InfiniteDetector.shiftByDistance-335"><span class="linenos">335</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.shiftByDistance-336"><a href="#InfiniteDetector.shiftByDistance-336"><span class="linenos">336</span></a><span class="sd">        Shift the Detector *by* the distance Shift along its normal vector Detector.normal.</span>
</span><span id="InfiniteDetector.shiftByDistance-337"><a href="#InfiniteDetector.shiftByDistance-337"><span class="linenos">337</span></a>
</span><span id="InfiniteDetector.shiftByDistance-338"><a href="#InfiniteDetector.shiftByDistance-338"><span class="linenos">338</span></a><span class="sd">        Parameters</span>
</span><span id="InfiniteDetector.shiftByDistance-339"><a href="#InfiniteDetector.shiftByDistance-339"><span class="linenos">339</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector.shiftByDistance-340"><a href="#InfiniteDetector.shiftByDistance-340"><span class="linenos">340</span></a><span class="sd">            Shift : float</span>
</span><span id="InfiniteDetector.shiftByDistance-341"><a href="#InfiniteDetector.shiftByDistance-341"><span class="linenos">341</span></a><span class="sd">                The distance (relative) *by* which to shift the Detector.</span>
</span><span id="InfiniteDetector.shiftByDistance-342"><a href="#InfiniteDetector.shiftByDistance-342"><span class="linenos">342</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.shiftByDistance-343"><a href="#InfiniteDetector.shiftByDistance-343"><span class="linenos">343</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Shift</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="InfiniteDetector.shiftByDistance-344"><a href="#InfiniteDetector.shiftByDistance-344"><span class="linenos">344</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_centre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">-</span> <span class="n">Shift</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span>  <span class="c1"># directly set _centre, i.e. circumvent setter</span>
</span><span id="InfiniteDetector.shiftByDistance-345"><a href="#InfiniteDetector.shiftByDistance-345"><span class="linenos">345</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="InfiniteDetector.shiftByDistance-346"><a href="#InfiniteDetector.shiftByDistance-346"><span class="linenos">346</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The Detector Distance Shift must be int or float.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Shift the Detector <em>by</em> the distance Shift along its normal vector <a href="#Detector.normal">Detector.normal</a>.</p>

<h2 id="parameters">Parameters</h2>

<pre><code>Shift : float
    The distance (relative) *by* which to shift the Detector.
</code></pre>
</div>


                            </div>
                            <div id="InfiniteDetector.get_PointList3D" class="classattr">
                                        <input id="InfiniteDetector.get_PointList3D-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_PointList3D</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">RayList</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="InfiniteDetector.get_PointList3D-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfiniteDetector.get_PointList3D"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="InfiniteDetector.get_PointList3D-359"><a href="#InfiniteDetector.get_PointList3D-359"><span class="linenos">359</span></a>    <span class="k">def</span> <span class="nf">get_PointList3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="InfiniteDetector.get_PointList3D-360"><a href="#InfiniteDetector.get_PointList3D-360"><span class="linenos">360</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.get_PointList3D-361"><a href="#InfiniteDetector.get_PointList3D-361"><span class="linenos">361</span></a><span class="sd">        Returns the list of 3D-points in lab-space where the rays in the</span>
</span><span id="InfiniteDetector.get_PointList3D-362"><a href="#InfiniteDetector.get_PointList3D-362"><span class="linenos">362</span></a><span class="sd">        list RayList hit the detector plane.</span>
</span><span id="InfiniteDetector.get_PointList3D-363"><a href="#InfiniteDetector.get_PointList3D-363"><span class="linenos">363</span></a>
</span><span id="InfiniteDetector.get_PointList3D-364"><a href="#InfiniteDetector.get_PointList3D-364"><span class="linenos">364</span></a><span class="sd">        Parameters</span>
</span><span id="InfiniteDetector.get_PointList3D-365"><a href="#InfiniteDetector.get_PointList3D-365"><span class="linenos">365</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector.get_PointList3D-366"><a href="#InfiniteDetector.get_PointList3D-366"><span class="linenos">366</span></a><span class="sd">            RayList : list[Ray]</span>
</span><span id="InfiniteDetector.get_PointList3D-367"><a href="#InfiniteDetector.get_PointList3D-367"><span class="linenos">367</span></a><span class="sd">                A list of objects of the ModuleOpticalRay.Ray-class.</span>
</span><span id="InfiniteDetector.get_PointList3D-368"><a href="#InfiniteDetector.get_PointList3D-368"><span class="linenos">368</span></a>
</span><span id="InfiniteDetector.get_PointList3D-369"><a href="#InfiniteDetector.get_PointList3D-369"><span class="linenos">369</span></a><span class="sd">        Returns</span>
</span><span id="InfiniteDetector.get_PointList3D-370"><a href="#InfiniteDetector.get_PointList3D-370"><span class="linenos">370</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector.get_PointList3D-371"><a href="#InfiniteDetector.get_PointList3D-371"><span class="linenos">371</span></a><span class="sd">            ListPointDetector3D : list[np.ndarray of shape (3,)]</span>
</span><span id="InfiniteDetector.get_PointList3D-372"><a href="#InfiniteDetector.get_PointList3D-372"><span class="linenos">372</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.get_PointList3D-373"><a href="#InfiniteDetector.get_PointList3D-373"><span class="linenos">373</span></a>        <span class="n">XY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_PointList2D</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="InfiniteDetector.get_PointList3D-374"><a href="#InfiniteDetector.get_PointList3D-374"><span class="linenos">374</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">XY</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],))</span>
</span><span id="InfiniteDetector.get_PointList3D-375"><a href="#InfiniteDetector.get_PointList3D-375"><span class="linenos">375</span></a>        <span class="n">XYZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">XY</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span><span class="n">Z</span><span class="p">]))</span>
</span><span id="InfiniteDetector.get_PointList3D-376"><a href="#InfiniteDetector.get_PointList3D-376"><span class="linenos">376</span></a>        <span class="n">XYZ</span> <span class="o">=</span> <span class="n">quaternion</span><span class="o">.</span><span class="n">rotate_vectors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="n">XYZ</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">centre</span>
</span><span id="InfiniteDetector.get_PointList3D-377"><a href="#InfiniteDetector.get_PointList3D-377"><span class="linenos">377</span></a>        <span class="k">return</span> <span class="n">XYZ</span>
</span></pre></div>


            <div class="docstring"><p>Returns the list of 3D-points in lab-space where the rays in the
list RayList hit the detector plane.</p>

<h2 id="parameters">Parameters</h2>

<pre><code>RayList : list[Ray]
    A list of objects of the ModuleOpticalRay.Ray-class.
</code></pre>

<h2 id="returns">Returns</h2>

<pre><code>ListPointDetector3D : list[np.ndarray of shape (3,)]
</code></pre>
</div>


                            </div>
                            <div id="InfiniteDetector.get_PointList2D" class="classattr">
                                        <input id="InfiniteDetector.get_PointList2D-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_PointList2D</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">RayList</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="InfiniteDetector.get_PointList2D-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfiniteDetector.get_PointList2D"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="InfiniteDetector.get_PointList2D-379"><a href="#InfiniteDetector.get_PointList2D-379"><span class="linenos">379</span></a>    <span class="k">def</span> <span class="nf">get_PointList2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="InfiniteDetector.get_PointList2D-380"><a href="#InfiniteDetector.get_PointList2D-380"><span class="linenos">380</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.get_PointList2D-381"><a href="#InfiniteDetector.get_PointList2D-381"><span class="linenos">381</span></a><span class="sd">        Returns the list of 2D-points in the detector plane, with the origin at Detector.centre.</span>
</span><span id="InfiniteDetector.get_PointList2D-382"><a href="#InfiniteDetector.get_PointList2D-382"><span class="linenos">382</span></a>
</span><span id="InfiniteDetector.get_PointList2D-383"><a href="#InfiniteDetector.get_PointList2D-383"><span class="linenos">383</span></a><span class="sd">        Parameters</span>
</span><span id="InfiniteDetector.get_PointList2D-384"><a href="#InfiniteDetector.get_PointList2D-384"><span class="linenos">384</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector.get_PointList2D-385"><a href="#InfiniteDetector.get_PointList2D-385"><span class="linenos">385</span></a><span class="sd">            RayList : list[Ray]</span>
</span><span id="InfiniteDetector.get_PointList2D-386"><a href="#InfiniteDetector.get_PointList2D-386"><span class="linenos">386</span></a><span class="sd">                A list of objects of the ModuleOpticalRay.Ray-class of length N</span>
</span><span id="InfiniteDetector.get_PointList2D-387"><a href="#InfiniteDetector.get_PointList2D-387"><span class="linenos">387</span></a>
</span><span id="InfiniteDetector.get_PointList2D-388"><a href="#InfiniteDetector.get_PointList2D-388"><span class="linenos">388</span></a><span class="sd">        Returns</span>
</span><span id="InfiniteDetector.get_PointList2D-389"><a href="#InfiniteDetector.get_PointList2D-389"><span class="linenos">389</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector.get_PointList2D-390"><a href="#InfiniteDetector.get_PointList2D-390"><span class="linenos">390</span></a><span class="sd">            XY : np.ndarray of shape (N,2)</span>
</span><span id="InfiniteDetector.get_PointList2D-391"><a href="#InfiniteDetector.get_PointList2D-391"><span class="linenos">391</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.get_PointList2D-392"><a href="#InfiniteDetector.get_PointList2D-392"><span class="linenos">392</span></a>        <span class="n">RayList</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">TranslationRayList</span><span class="p">(</span><span class="n">RayList</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">centre</span><span class="p">)</span>
</span><span id="InfiniteDetector.get_PointList2D-393"><a href="#InfiniteDetector.get_PointList2D-393"><span class="linenos">393</span></a>        <span class="n">RayList</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">RotationRayListByQ</span><span class="p">(</span><span class="n">RayList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span>
</span><span id="InfiniteDetector.get_PointList2D-394"><a href="#InfiniteDetector.get_PointList2D-394"><span class="linenos">394</span></a>        <span class="n">X</span><span class="p">,</span><span class="n">Y</span> <span class="o">=</span> <span class="n">mgeo</span><span class="o">.</span><span class="n">IntersectionRayListZPlane</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="InfiniteDetector.get_PointList2D-395"><a href="#InfiniteDetector.get_PointList2D-395"><span class="linenos">395</span></a>        <span class="n">XY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">]))</span>
</span><span id="InfiniteDetector.get_PointList2D-396"><a href="#InfiniteDetector.get_PointList2D-396"><span class="linenos">396</span></a>        <span class="k">return</span> <span class="n">XY</span>
</span></pre></div>


            <div class="docstring"><p>Returns the list of 2D-points in the detector plane, with the origin at <a href="#Detector.centre">Detector.centre</a>.</p>

<h2 id="parameters">Parameters</h2>

<pre><code>RayList : list[Ray]
    A list of objects of the ModuleOpticalRay.Ray-class of length N
</code></pre>

<h2 id="returns">Returns</h2>

<pre><code>XY : np.ndarray of shape (N,2)
</code></pre>
</div>


                            </div>
                            <div id="InfiniteDetector.get_PointList2DCentre" class="classattr">
                                        <input id="InfiniteDetector.get_PointList2DCentre-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_PointList2DCentre</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">RayList</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="InfiniteDetector.get_PointList2DCentre-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfiniteDetector.get_PointList2DCentre"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="InfiniteDetector.get_PointList2DCentre-398"><a href="#InfiniteDetector.get_PointList2DCentre-398"><span class="linenos">398</span></a>    <span class="k">def</span> <span class="nf">get_PointList2DCentre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="InfiniteDetector.get_PointList2DCentre-399"><a href="#InfiniteDetector.get_PointList2DCentre-399"><span class="linenos">399</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.get_PointList2DCentre-400"><a href="#InfiniteDetector.get_PointList2DCentre-400"><span class="linenos">400</span></a><span class="sd">        Returns the list of 2D-points in the detector plane, with the origin centered in the point cloud.</span>
</span><span id="InfiniteDetector.get_PointList2DCentre-401"><a href="#InfiniteDetector.get_PointList2DCentre-401"><span class="linenos">401</span></a>
</span><span id="InfiniteDetector.get_PointList2DCentre-402"><a href="#InfiniteDetector.get_PointList2DCentre-402"><span class="linenos">402</span></a><span class="sd">        Parameters</span>
</span><span id="InfiniteDetector.get_PointList2DCentre-403"><a href="#InfiniteDetector.get_PointList2DCentre-403"><span class="linenos">403</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector.get_PointList2DCentre-404"><a href="#InfiniteDetector.get_PointList2DCentre-404"><span class="linenos">404</span></a><span class="sd">            RayList* : list[Ray]</span>
</span><span id="InfiniteDetector.get_PointList2DCentre-405"><a href="#InfiniteDetector.get_PointList2DCentre-405"><span class="linenos">405</span></a><span class="sd">                A list of objects of the ModuleOpticalRay.Ray-class.</span>
</span><span id="InfiniteDetector.get_PointList2DCentre-406"><a href="#InfiniteDetector.get_PointList2DCentre-406"><span class="linenos">406</span></a>
</span><span id="InfiniteDetector.get_PointList2DCentre-407"><a href="#InfiniteDetector.get_PointList2DCentre-407"><span class="linenos">407</span></a><span class="sd">        Returns</span>
</span><span id="InfiniteDetector.get_PointList2DCentre-408"><a href="#InfiniteDetector.get_PointList2DCentre-408"><span class="linenos">408</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector.get_PointList2DCentre-409"><a href="#InfiniteDetector.get_PointList2DCentre-409"><span class="linenos">409</span></a><span class="sd">            ListPointDetector2DCentre : list[np.ndarray of shape (2,)]</span>
</span><span id="InfiniteDetector.get_PointList2DCentre-410"><a href="#InfiniteDetector.get_PointList2DCentre-410"><span class="linenos">410</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.get_PointList2DCentre-411"><a href="#InfiniteDetector.get_PointList2DCentre-411"><span class="linenos">411</span></a>        <span class="n">ArrayPointDetector2D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_PointList2D</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="InfiniteDetector.get_PointList2DCentre-412"><a href="#InfiniteDetector.get_PointList2DCentre-412"><span class="linenos">412</span></a>        <span class="n">ArrayPointDetector2D</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ArrayPointDetector2D</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="InfiniteDetector.get_PointList2DCentre-413"><a href="#InfiniteDetector.get_PointList2DCentre-413"><span class="linenos">413</span></a>        <span class="k">return</span> <span class="n">ArrayPointDetector2D</span>
</span></pre></div>


            <div class="docstring"><p>Returns the list of 2D-points in the detector plane, with the origin centered in the point cloud.</p>

<h2 id="parameters">Parameters</h2>

<pre><code>RayList* : list[Ray]
    A list of objects of the ModuleOpticalRay.Ray-class.
</code></pre>

<h2 id="returns">Returns</h2>

<pre><code>ListPointDetector2DCentre : list[np.ndarray of shape (2,)]
</code></pre>
</div>


                            </div>
                            <div id="InfiniteDetector.get_Delays" class="classattr">
                                        <input id="InfiniteDetector.get_Delays-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_Delays</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">RayList</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="InfiniteDetector.get_Delays-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InfiniteDetector.get_Delays"></a>
            <div class="chroma pdoc-code"><pre><span></span><span id="InfiniteDetector.get_Delays-415"><a href="#InfiniteDetector.get_Delays-415"><span class="linenos">415</span></a>    <span class="k">def</span> <span class="nf">get_Delays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RayList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="InfiniteDetector.get_Delays-416"><a href="#InfiniteDetector.get_Delays-416"><span class="linenos">416</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.get_Delays-417"><a href="#InfiniteDetector.get_Delays-417"><span class="linenos">417</span></a><span class="sd">        Returns the list of delays of the rays of RayList as they hit the detector plane,</span>
</span><span id="InfiniteDetector.get_Delays-418"><a href="#InfiniteDetector.get_Delays-418"><span class="linenos">418</span></a><span class="sd">        calculated as their total path length divided by the speed of light.</span>
</span><span id="InfiniteDetector.get_Delays-419"><a href="#InfiniteDetector.get_Delays-419"><span class="linenos">419</span></a><span class="sd">        The delays are relative to the mean “travel time”, i.e. the mean path length of RayList</span>
</span><span id="InfiniteDetector.get_Delays-420"><a href="#InfiniteDetector.get_Delays-420"><span class="linenos">420</span></a><span class="sd">        divided by the speed of light.</span>
</span><span id="InfiniteDetector.get_Delays-421"><a href="#InfiniteDetector.get_Delays-421"><span class="linenos">421</span></a><span class="sd">        The list index corresponds to that of the RayList.</span>
</span><span id="InfiniteDetector.get_Delays-422"><a href="#InfiniteDetector.get_Delays-422"><span class="linenos">422</span></a>
</span><span id="InfiniteDetector.get_Delays-423"><a href="#InfiniteDetector.get_Delays-423"><span class="linenos">423</span></a><span class="sd">        Parameters</span>
</span><span id="InfiniteDetector.get_Delays-424"><a href="#InfiniteDetector.get_Delays-424"><span class="linenos">424</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector.get_Delays-425"><a href="#InfiniteDetector.get_Delays-425"><span class="linenos">425</span></a><span class="sd">            RayList : list[Ray]</span>
</span><span id="InfiniteDetector.get_Delays-426"><a href="#InfiniteDetector.get_Delays-426"><span class="linenos">426</span></a><span class="sd">                A list of objects of the ModuleOpticalRay.Ray-class.</span>
</span><span id="InfiniteDetector.get_Delays-427"><a href="#InfiniteDetector.get_Delays-427"><span class="linenos">427</span></a>
</span><span id="InfiniteDetector.get_Delays-428"><a href="#InfiniteDetector.get_Delays-428"><span class="linenos">428</span></a><span class="sd">        Returns</span>
</span><span id="InfiniteDetector.get_Delays-429"><a href="#InfiniteDetector.get_Delays-429"><span class="linenos">429</span></a><span class="sd">        ----------</span>
</span><span id="InfiniteDetector.get_Delays-430"><a href="#InfiniteDetector.get_Delays-430"><span class="linenos">430</span></a><span class="sd">            DelayList : list[float]</span>
</span><span id="InfiniteDetector.get_Delays-431"><a href="#InfiniteDetector.get_Delays-431"><span class="linenos">431</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InfiniteDetector.get_Delays-432"><a href="#InfiniteDetector.get_Delays-432"><span class="linenos">432</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iscomplete</span><span class="p">():</span>
</span><span id="InfiniteDetector.get_Delays-433"><a href="#InfiniteDetector.get_Delays-433"><span class="linenos">433</span></a>            <span class="n">DetectorPointList3D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_PointList3D</span><span class="p">(</span><span class="n">RayList</span><span class="p">)</span>
</span><span id="InfiniteDetector.get_Delays-434"><a href="#InfiniteDetector.get_Delays-434"><span class="linenos">434</span></a>            <span class="n">OpticalPathList</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="InfiniteDetector.get_Delays-435"><a href="#InfiniteDetector.get_Delays-435"><span class="linenos">435</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">RayList</span><span class="p">)):</span>
</span><span id="InfiniteDetector.get_Delays-436"><a href="#InfiniteDetector.get_Delays-436"><span class="linenos">436</span></a>                <span class="n">OpticalPathList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">RayList</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">point</span> <span class="o">-</span> <span class="n">DetectorPointList3D</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RayList</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
</span><span id="InfiniteDetector.get_Delays-437"><a href="#InfiniteDetector.get_Delays-437"><span class="linenos">437</span></a>
</span><span id="InfiniteDetector.get_Delays-438"><a href="#InfiniteDetector.get_Delays-438"><span class="linenos">438</span></a>            <span class="n">MeanPath</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">OpticalPathList</span><span class="p">)</span>
</span><span id="InfiniteDetector.get_Delays-439"><a href="#InfiniteDetector.get_Delays-439"><span class="linenos">439</span></a>            <span class="n">DelayList</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span> <span class="o">-</span> <span class="n">MeanPath</span><span class="p">)</span> <span class="o">/</span> <span class="n">LightSpeed</span> <span class="o">*</span> <span class="mf">1e15</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">OpticalPathList</span><span class="p">]</span>  <span class="c1"># in fs, c in mm/s</span>
</span><span id="InfiniteDetector.get_Delays-440"><a href="#InfiniteDetector.get_Delays-440"><span class="linenos">440</span></a>            <span class="k">return</span> <span class="n">DelayList</span>
</span></pre></div>


            <div class="docstring"><p>Returns the list of delays of the rays of RayList as they hit the detector plane,
calculated as their total path length divided by the speed of light.
The delays are relative to the mean “travel time”, i.e. the mean path length of RayList
divided by the speed of light.
The list index corresponds to that of the RayList.</p>

<h2 id="parameters">Parameters</h2>

<pre><code>RayList : list[Ray]
    A list of objects of the ModuleOpticalRay.Ray-class.
</code></pre>

<h2 id="returns">Returns</h2>

<pre><code>DelayList : list[float]
</code></pre>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Detector">Detector</a></dt>
                                <dd id="InfiniteDetector.r" class="variable"><a href="#Detector.r">r</a></dd>
                <dd id="InfiniteDetector.q" class="variable"><a href="#Detector.q">q</a></dd>
                <dd id="InfiniteDetector.basepoint" class="variable"><a href="#Detector.basepoint">basepoint</a></dd>
                <dd id="InfiniteDetector.get_2D_points" class="function"><a href="#Detector.get_2D_points">get_2D_points</a></dd>
                <dd id="InfiniteDetector.get_3D_points" class="function"><a href="#Detector.get_3D_points">get_3D_points</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
</div>


<style>pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
<style>:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
<style>.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
<style>.pdoc *{scroll-margin:4rem;}</style>